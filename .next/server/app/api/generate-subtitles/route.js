"use strict";(()=>{var t={};t.id=1005,t.ids=[1005],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3410:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>F,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>c,POST:()=>S});var i=r(9303),a=r(8716),o=r(670),s=r(7070);let l=[{Name:"Title",Fontname:"나눔스퀘어 Bold",Fontsize:100,PrimaryColour:"&H00FFFFFF",SecondaryColour:"&H00FFFFFF",OutlineColour:"&H00000000",BackColour:"&H80000000",Bold:0,Italic:0,Underline:0,StrikeOut:0,ScaleX:100,ScaleY:100,Spacing:0,Angle:0,BorderStyle:1,Outline:1,Shadow:0,Alignment:4,MarginL:10,MarginR:10,MarginV:10,Encoding:1},{Name:"Default",Fontname:"나눔스퀘어 Regular",Fontsize:72,PrimaryColour:"&H00FFFFFF",SecondaryColour:"&H00FFFFFF",OutlineColour:"&H00000000",BackColour:"&H80000000",Bold:0,Italic:0,Underline:0,StrikeOut:0,ScaleX:100,ScaleY:100,Spacing:0,Angle:0,BorderStyle:1,Outline:1,Shadow:0,Alignment:2,MarginL:10,MarginR:10,MarginV:10,Encoding:1},{Name:"Rank",Fontname:"나눔스퀘어 Bold",Fontsize:100,PrimaryColour:"&H00FFFFFF",SecondaryColour:"&H00FFFFFF",OutlineColour:"&H00000000",BackColour:"&H80000000",Bold:0,Italic:0,Underline:0,StrikeOut:0,ScaleX:100,ScaleY:100,Spacing:0,Angle:0,BorderStyle:1,Outline:1,Shadow:0,Alignment:2,MarginL:0,MarginR:10,MarginV:0,Encoding:1}];class u{generateASSFile(t){let e=[],r=t.duration||5,n=0;if(t.title&&(e.push(this.createDialogue({start:this.formatTime(n),end:this.formatTime(n+r),style:"Title",text:t.title})),n+=r+1),t.opening&&t.opening.length>0)for(let i of t.opening)e.push(this.createDialogue({start:this.formatTime(n),end:this.formatTime(n+r),style:"Default",text:i})),n+=r;if(t.snippets)for(let i of t.snippets)for(let t of(e.push(this.createDialogue({start:this.formatTime(n),end:this.formatTime(n+2),style:"Rank",text:`${i.rank}. ${i.title}`})),n+=3,i.script))e.push(this.createDialogue({start:this.formatTime(n),end:this.formatTime(n+r),style:"Default",text:t})),n+=r;return{scriptInfo:this.scriptInfo,styles:l,dialogues:e}}generateASSText(t){let e=[];for(let[r,n]of(e.push("[Script Info]"),Object.entries(t.scriptInfo)))e.push(`${r}: ${n}`);for(let r of(e.push(""),e.push("[V4+ Styles]"),e.push("Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding"),t.styles)){let t=[`Style: ${r.Name}`,r.Fontname,r.Fontsize.toString(),r.PrimaryColour,r.SecondaryColour,r.OutlineColour,r.BackColour,r.Bold.toString(),r.Italic.toString(),r.Underline.toString(),r.StrikeOut.toString(),r.ScaleX.toString(),r.ScaleY.toString(),r.Spacing.toString(),r.Angle.toString(),r.BorderStyle.toString(),r.Outline.toString(),r.Shadow.toString(),r.Alignment.toString(),r.MarginL.toString(),r.MarginR.toString(),r.MarginV.toString(),r.Encoding.toString()].join(",");e.push(t)}for(let r of(e.push(""),e.push("[Events]"),e.push("Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text"),t.dialogues)){let t=[`Dialogue: ${r.Layer}`,r.Start,r.End,r.Style,r.Name,r.MarginL.toString(),r.MarginR.toString(),r.MarginV.toString(),r.Effect,r.Text].join(",");e.push(t)}return e.join("\n")}createDialogue(t){return{Layer:0,Start:t.start,End:t.end,Style:t.style,Name:"",MarginL:0,MarginR:0,MarginV:0,Effect:"",Text:t.text}}formatTime(t){return`${Math.floor(t/3600).toString().padStart(1,"0")}:${Math.floor(t%3600/60).toString().padStart(2,"0")}:${Math.floor(t%60).toString().padStart(2,"0")}.${Math.floor(t%1*100).toString().padStart(2,"0")}`}convertToSRT(t){let e=[],r=1;for(let n of t.dialogues){let t=this.parseTime(n.Start),i=this.parseTime(n.End);e.push(r.toString()),e.push(`${this.formatSRTTime(t)} --> ${this.formatSRTTime(i)}`),e.push(n.Text),e.push(""),r++}return e.join("\n")}parseTime(t){let[e,r]=t.split("."),[n,i,a]=e.split(":").map(Number);return 3600*n+60*i+a+parseInt(r||"0",10)/100}formatSRTTime(t){return`${Math.floor(t/3600).toString().padStart(2,"0")}:${Math.floor(t%3600/60).toString().padStart(2,"0")}:${Math.floor(t%60).toString().padStart(2,"0")},${Math.floor(t%1*1e3).toString().padStart(3,"0")}`}constructor(){this.scriptInfo={ScriptType:"v4.00+",PlayResX:1080,PlayResY:1920,WrapStyle:0}}}let g=null,p=()=>(g||(g=new u),g);async function S(t){try{let e,r,n;let i=await t.json();if(!i.script)return s.NextResponse.json({error:"script 필드가 필요합니다."},{status:400});let a=i.script,o=i.format||"ass",l=i.duration||5,u=p(),g=u.generateASSFile({title:a.title,opening:a.openingSegment?.script||[],snippets:a.snippets.map(t=>({title:t.title||t.headline||"제목 없음",rank:t.rank||1,script:Array.isArray(t.script)?t.script:[t.script||""]})),duration:l});"srt"===o?(e=u.convertToSRT(g),r="text/plain",n="subtitles.srt"):(e=u.generateASSText(g),r="text/x-ass",n="subtitles.ass");let S=Buffer.from(e,"utf-8").toString("base64");return s.NextResponse.json({success:!0,data:{content:S,format:o,fileName:n,contentType:r,totalDialogues:g.dialogues.length,totalStyles:g.styles.length}})}catch(t){return console.error("자막 생성 API 오류:",t),s.NextResponse.json({error:"자막 생성에 실패했습니다.",details:t instanceof Error?t.message:"알 수 없는 오류"},{status:500})}}async function c(){return s.NextResponse.json({message:"SurvivingVid 자막 생성 API",endpoints:{POST:"/api/generate-subtitles",description:"ASS/SRT 형식의 자막 생성"},usage:{script:"ScriptResponse (필수) - 생성된 스크립트 데이터",format:"string (선택) - 출력 형식 (ass 또는 srt, 기본값: ass)",duration:"number (선택) - 자막 표시 시간 (초, 기본값: 5)"},availableFormats:{ass:"Advanced SubStation Alpha format",srt:"SubRip Text format"},styles:{Title:"100pt, 중앙 정렬, 나눔스퀘어 Bold",Default:"72pt, 하단 정렬, 나눔스퀘어 Regular",Rank:"100pt, 하단 좌측 정렬, 나눔스퀘어 Bold"}})}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/generate-subtitles/route",pathname:"/api/generate-subtitles",filename:"route",bundlePath:"app/api/generate-subtitles/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\generate-subtitles\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=d,F="/api/generate-subtitles/route";function y(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}}};var e=require("../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),n=e.X(0,[9276,5972],()=>r(3410));module.exports=n})();