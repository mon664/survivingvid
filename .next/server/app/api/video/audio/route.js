"use strict";(()=>{var e={};e.id=3476,e.ids=[3476],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7449:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>v,routeModule:()=>h,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var r={};o.r(r),o.d(r,{GET:()=>l,POST:()=>d});var a=o(9303),n=o(8716),i=o(670),s=o(7070);let u=new Map;async function d(e){try{let{videoId:t,storyData:o,voiceType:r="female",speed:a=1}=await e.json();if(!t||!o||!o.narration)return s.NextResponse.json({error:"videoId와 storyData.narration이 필요합니다."},{status:400});let n=await c(o.narration,r,a),i={videoId:t,audioId:`audio_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:o.narration,voiceType:r,speed:a,duration:n.duration,audioUrl:`/api/video/audio/${n.audioId}`,createdAt:new Date().toISOString(),status:"completed",dataUrl:n.dataUrl};return u.set(i.audioId,i),s.NextResponse.json({success:!0,audioId:i.audioId,audioUrl:i.audioUrl,text:i.text,voiceType:i.voiceType,speed:i.speed,duration:i.duration,status:i.status})}catch(e){return console.error("음성 생성 오류:",e),s.NextResponse.json({error:"음성 생성 중 오류가 발생했습니다."},{status:500})}}async function l(e){try{let{searchParams:t}=new URL(e.url),o=t.get("audioId"),r=t.get("videoId");if(o){let e=u.get(o);if(!e)return s.NextResponse.json({error:"오디오를 찾을 수 없습니다."},{status:404});return s.NextResponse.json({success:!0,audio:e})}if(!r)return s.NextResponse.json({error:"audioId 또는 videoId가 필요합니다."},{status:400});{let e=Array.from(u.values()).filter(e=>e.videoId===r);return s.NextResponse.json({success:!0,videoId:r,audios:e,totalAudios:e.length})}}catch(e){return console.error("오디오 정보 조회 오류:",e),s.NextResponse.json({error:"오디오 정보 조회 중 오류가 발생했습니다."},{status:500})}}async function c(e,t,o){try{if(process.env.GOOGLE_CLOUD_PROJECT_ID&&process.env.VERTEX_AI_API_KEY)return await p(e,t,o);return await g(e,t,o)}catch(r){return console.error("TTS 생성 실패:",r),await g(e,t,o)}}async function p(e,t,o){let r=`tts_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;try{let a=await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${process.env.VERTEX_AI_API_KEY}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:e},voice:{languageCode:"ko-KR",name:"male"===t?"ko-KR-Wavenet-B":"ko-KR-Wavenet-A",ssmlGender:"male"===t?"MALE":"FEMALE"},audioConfig:{audioEncoding:"MP3",speakingRate:o,pitch:0,volumeGainDb:0}})});if(!a.ok)throw Error(`Google TTS API 오류: ${a.status} ${a.statusText}`);let n=await a.json();if(n.audioContent){let t=`data:audio/mp3;base64,${n.audioContent}`,o=Math.ceil(e.length/4.5);return{audioId:r,dataUrl:t,duration:o}}throw Error("오디오 데이터를 받지 못했습니다.")}catch(e){throw console.error("Google TTS 실패:",e),e}}async function g(e,t,o){let r=`fallback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a=JSON.stringify({text:e.substring(0,200),voiceType:t,speed:o,timestamp:new Date().toISOString(),estimatedWords:e.split(" ").length,estimatedDuration:Math.ceil(e.length/4.5),quality:"fallback"},null,2),n=Buffer.from(a,"utf8"),i=Buffer.from([82,73,70,70,0,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,1,0,68,172,0,0,136,88,1,0,1,0,8,0,100,97,116,97,0,0,0,0]),s=Buffer.concat([i,n]);return s.writeUInt32LE(s.length-8,4),s.writeUInt32LE(n.length,40),{audioId:r,dataUrl:`data:audio/wav;base64,${s.toString("base64")}`,duration:Math.ceil(e.length/4.5)}}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/video/audio/route",pathname:"/api/video/audio",filename:"route",bundlePath:"app/api/video/audio/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\video\\audio\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:v,staticGenerationAsyncStorage:f,serverHooks:m}=h,x="/api/video/audio/route";function y(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[9276,5972],()=>o(7449));module.exports=r})();