"use strict";(()=>{var e={};e.id=4468,e.ids=[4468],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2660:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{DELETE:()=>p,GET:()=>g,PUT:()=>l});var a=r(9303),n=r(8716),i=r(670),o=r(7070),u=r(9137),d=r(8040);async function g(e,{params:t}){try{let r=t.imageId,s=u.j.getImage(r);if(!s)return o.NextResponse.json({error:"이미지를 찾을 수 없습니다."},{status:404});let{searchParams:a}=new URL(e.url),n=a.get("regenerate");if("true"===n){let e=await (0,d.generateImage)(s.prompt,s.sceneDescription,s.imageModel),t={...s,dataUrl:e.dataUrl,width:e.width,height:e.height,createdAt:new Date().toISOString(),regenerations:(s.regenerations||0)+1};return u.j.setImage(r,t),o.NextResponse.json({success:!0,imageId:r,imageUrl:t.imageUrl,status:"regenerated",dimensions:{width:t.width,height:t.height},regenerations:t.regenerations})}if("string"==typeof s.dataUrl&&s.dataUrl.startsWith("data:")){let[e,t]=s.dataUrl.split(",");if(!e||!t)return o.NextResponse.json({error:"잘못된 이미지 데이터 형식입니다"},{status:400});let r=Buffer.from(t,"base64"),a=e.split(":")[1].split(";")[0];return new o.NextResponse(r,{headers:{"Content-Type":a,"Cache-Control":"public, max-age=3600","Access-Control-Allow-Origin":"*"}})}if(s.imageUrl){if(s.imageUrl.startsWith("http"))return o.NextResponse.redirect(s.imageUrl);return o.NextResponse.redirect(new URL(s.imageUrl,e.url))}return o.NextResponse.json({error:"유효한 이미지 데이터가 없습니다"},{status:400})}catch(e){return console.error("이미지 조회 오류:",e),o.NextResponse.json({error:"이미지 조회 중 오류가 발생했습니다."},{status:500})}}async function p(e,{params:t}){try{let e=t.imageId;if(!u.j.getImage(e))return o.NextResponse.json({error:"삭제할 이미지를 찾을 수 없습니다."},{status:404});return u.j.deleteImage(e),o.NextResponse.json({success:!0,message:"이미지가 성공적으로 삭제되었습니다.",deletedImageId:e})}catch(e){return console.error("이미지 삭제 오류:",e),o.NextResponse.json({error:"이미지 삭제 중 오류가 발생했습니다."},{status:500})}}async function l(e,{params:t}){try{let{approved:r,feedback:s}=await e.json(),a=t.imageId,n=u.j.getImage(a);if(!n)return o.NextResponse.json({error:"검수할 이미지를 찾을 수 없습니다."},{status:404});let i={...n,reviewed:!0,approved:r,feedback:s,reviewedAt:new Date().toISOString(),reviewer:"demo_user"};return u.j.setImage(a,i),o.NextResponse.json({success:!0,imageId:a,approved:r,feedback:s,reviewedAt:i.reviewedAt})}catch(e){return console.error("이미지 검수 오류:",e),o.NextResponse.json({error:"이미지 검수 중 오류가 발생했습니다."},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/video/images/[imageId]/route",pathname:"/api/video/images/[imageId]",filename:"route",bundlePath:"app/api/video/images/[imageId]/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\video\\images\\[imageId]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:x}=c,j="/api/video/images/[imageId]/route";function v(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,8040],()=>r(2660));module.exports=s})();