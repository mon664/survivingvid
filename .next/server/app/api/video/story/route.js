"use strict";(()=>{var e={};e.id=6715,e.ids=[6715],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9479:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{POST:()=>l});var a=r(9303),i=r(8716),o=r(670),s=r(7070),u=r(4837);async function l(e){let t=Date.now();try{var r;let n,a;let{prompt:i,style:o="professional",duration:u=60,targetAudience:l="general",language:p="ko",quality:m="standard"}=await c(e),g=(r=p,(n=i.trim()).length>500&&(n=n.substring(0,500)+"...",console.log("\uD83D\uDD27 í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ìµœì í™”ë¨")),/[ê°€-í£]/.test(n)&&"ko"!==r&&(r="ko"),a=u,u<30&&(a=30),u>300&&(a=300),{prompt:n,style:o,duration:a,targetAudience:l,language:r,quality:m});console.log("\uD83C\uDFAC ìŠ¤í† ë¦¬ ìƒì„± ì‹œì‘:",{prompt:g.prompt,style:g.style,duration:g.duration,targetAudience:g.targetAudience});let y=await d(g),h=Date.now()-t;return console.log(`âœ… ìŠ¤í† ë¦¬ ìƒì„± ì™„ë£Œ: ${h}ms`),s.NextResponse.json({success:!0,story:y,prompt:g.prompt,metadata:{style:g.style||"professional",duration:g.duration||5,targetAudience:g.targetAudience||"general",estimatedScenes:y.scenes.length,createdAt:new Date().toISOString(),quality:g.quality||"standard",language:g.language||"korean",processingTime:h,aiModel:"gemini-1.5-flash-latest"},performance:{scriptQuality:y.qualityScore||0,promptOptimization:g.prompt!==i,fallbackUsed:y.fallbackUsed||!1}})}catch(r){let e=Date.now()-t;return console.error("âŒ ìŠ¤í† ë¦¬ ìƒì„± ì˜¤ë¥˜:",{error:r.message,stack:r.stack,processingTime:e}),s.NextResponse.json({success:!1,story:null,prompt:"",metadata:{style:"professional",duration:60,targetAudience:"general",estimatedScenes:0,createdAt:new Date().toISOString(),quality:"standard",language:"ko",processingTime:e,aiModel:"error"},error:`ìŠ¤í† ë¦¬ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${r.message}`},{status:500})}}async function c(e){try{let t=await e.json();if(!t||"object"!=typeof t)throw Error("ìœ íš¨í•œ JSON ìš”ì²­ ë³¸ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");if(!t.prompt||"string"!=typeof t.prompt||0===t.prompt.trim().length)throw Error("í”„ë¡¬í”„íŠ¸ëŠ” í•„ìˆ˜ í•­ëª©ì´ë©°, ë¹„ì–´ìˆì§€ ì•Šì€ ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");let r=["professional","casual","dramatic","educational"];if(t.style&&!r.includes(t.style))throw Error(`ìœ íš¨í•˜ì§€ ì•Šì€ ìŠ¤íƒ€ì¼: ${t.style}. ê°€ëŠ¥í•œ ê°’: ${r.join(", ")}`);if(t.duration&&("number"!=typeof t.duration||t.duration<10||t.duration>600))throw Error("ì§€ì†ì‹œê°„ì€ 10ì´ˆì—ì„œ 600ì´ˆ ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.");let n=["general","beginner","expert","students"];if(t.targetAudience&&!n.includes(t.targetAudience))throw Error(`ìœ íš¨í•˜ì§€ ì•Šì€ íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤: ${t.targetAudience}. ê°€ëŠ¥í•œ ê°’: ${n.join(", ")}`);return t}catch(e){if(e instanceof SyntaxError)throw Error("ì˜ëª»ëœ JSON í˜•ì‹ì…ë‹ˆë‹¤.");throw e}}async function d(e){let t=(0,u.u_)();try{var r,n;console.log("\uD83E\uDD16 Gemini APIë¡œ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘...");let a=(r=e.duration||5,n=e.quality||"standard",Math.max(3,Math.min(Math.ceil(r/60*(4*(({standard:1,high:1.3,premium:1.6})[n]||1))),20))),i={subject:e.prompt,requestNumber:a,requestLanguage:e.language,includeOpeningSegment:!0,includeClosingSegment:!0,includeImageGenPrompt:!0},o=await t.generateScriptWithRetry(i,3,!0),s=t.calculateScriptQuality(o);return console.log(`ğŸ“Š ìŠ¤í¬ë¦½íŠ¸ í’ˆì§ˆ ì ìˆ˜: ${s}/100`),{...function(e,t,r){var n,a,i,o;let s=`story_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,u=[];u.push((n=e.openingSegment,a=t.style||"professional",{sceneNumber:1,title:n.videoSearchKeyword?.join(", ")||"ë§¤ë ¥ì ì¸ ì˜¤í”„ë‹",description:n.script?.join(" ")||"ì‹œì²­ìì˜ í¥ë¯¸ë¥¼ ë„ëŠ” ì˜¤í”„ë‹",duration:4,visualStyle:a,audioType:"intro_music",narration:n.script?.join(" ")||"ì•ˆë…•í•˜ì„¸ìš”, ì˜¤ëŠ˜ í¥ë¯¸ë¡œìš´ ì£¼ì œë¥¼ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤.",camera:"wide_shot",transition:"fade_in",imagePrompt:n.imageGenPrompt||"ë§¤ë ¥ì ì¸ ì˜¤í”„ë‹ ì¥ë©´",mood:"engaging",energy:"medium"})),e.snippets.forEach((r,n)=>{var a,i;let o=function(e,t,r){let n=Math.floor((e-9)/t);return 0===r||r===t-1?n+1:n}(t.duration||5,e.snippets.length,n);u.push((a=t.style||"professional",{sceneNumber:i=n+2,title:r.segmentTitle||`ì¥ë©´ ${i}`,description:r.script?.join(" ")||"ë‚´ìš© ì„¤ëª…",duration:o,visualStyle:a,audioType:"voice_main",narration:r.script?.join(" ")||"ì¥ë©´ ë‚´ìš© ì„¤ëª…",camera:function(e){let t=e.script?.join(" ").toLowerCase()||"";return t.includes("ì „ì²´")||t.includes("ê°œìš”")?"wide_shot":t.includes("ìƒì„¸")||t.includes("ìì„¸íˆ")?"close_up":(t.includes("ë¹„êµ")||t.includes("ëŒ€ë¹„"),"medium_shot")}(r),transition:"cut",imagePrompt:r.imageGenPrompt||"ê´€ë ¨ ì‹œê°ì  ì¥ë©´",mood:function(e){let t=e.script?.join(" ").toLowerCase()||"";return t.includes("í¥ë¯¸")||t.includes("ë†€ë¼ìš´")?"exciting":t.includes("ì°¨ë¶„")||t.includes("í¸ì•ˆ")?"calm":t.includes("ê¸´ì¥")||t.includes("ì¤‘ìš”")?"tense":"neutral"}(r),energy:function(e){let t=e.script?.join(" ").toLowerCase()||"";return t.includes("ê°•ë ¥")||t.includes("ì—­ë™")?"high":t.includes("ë¶€ë“œëŸ½")||t.includes("ì²œì²œíˆ")?"low":"medium"}(r)}))}),u.push((i=t.prompt,o=t.style||"professional",{sceneNumber:u.length+1,title:"ì—”ë”© ë° ë§ˆë¬´ë¦¬",description:`í•µì‹¬ ë‚´ìš©ì„ ìš”ì•½í•˜ê³  ê¹Šì€ ì¸ìƒì„ ë‚¨ê¹ë‹ˆë‹¤: ${i}`,duration:5,visualStyle:o,audioType:"outro_music",narration:`ì˜¤ëŠ˜ ${i}ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. ì‹œì²­í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ë‹¤ìŒ ì˜ìƒì—ì„œ ë§Œë‚˜ìš”!`,camera:"wide_shot",transition:"fade_out",imagePrompt:"ë§Œì¡±ìŠ¤ëŸ¬ìš´ ì—”ë”© ì¥ë©´",mood:"conclusive",energy:"low"}));let l=u.map(e=>e.narration).join(" "),c=p(u);return{storyId:s,title:e.title,style:t.style,targetAudience:t.targetAudience,totalDuration:t.duration,scenes:u,narration:l,transitions:c,enhancedMetadata:{scriptQuality:r,sceneCount:u.length,averageSceneDuration:Math.round((t.duration||5)/u.length),styleConsistency:function(e){let t=new Set(e.map(e=>e.visualStyle));return 1===t.size?100:Math.max(50,100-(t.size-1)*10)}(u),narrativeFlow:function(e){if(e.length<3)return 50;let t=70,r=e[0]?.audioType==="intro_music",n=e[e.length-1]?.audioType==="outro_music";return r&&(t+=15),n&&(t+=15),Math.min(t,100)}(u),language:t.language||"korean",quality:t.quality||"standard"}}}(o,e,s),qualityScore:s,fallbackUsed:!1}}catch(t){return console.error("âŒ Gemini ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì‹¤íŒ¨, í´ë°± ì‚¬ìš©:",t),function(e){console.log("\uD83D\uDD04 í´ë°± ìŠ¤í† ë¦¬ ìƒì„± ì¤‘...");let t=`fallback_story_${Date.now()}`,r=[{sceneNumber:1,title:"ì†Œê°œ",description:`${e.prompt}ì— ëŒ€í•œ ì†Œê°œ`,duration:(e.duration||5)/3,visualStyle:e.style||"professional",audioType:"voice_main",narration:`${e.prompt}ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.`,camera:"medium_shot",transition:"fade_in"},{sceneNumber:2,title:"ì£¼ìš” ë‚´ìš©",description:`${e.prompt}ì˜ í•µì‹¬ ë‚´ìš©`,duration:(e.duration||5)/3,visualStyle:e.style||"professional",audioType:"voice_main",narration:`${e.prompt}ì˜ ê°€ì¥ ì¤‘ìš”í•œ íŠ¹ì§•ë“¤ì„ ì‚´í´ë´…ë‹ˆë‹¤.`,camera:"close_up",transition:"cut"},{sceneNumber:3,title:"ë§ˆë¬´ë¦¬",description:`${e.prompt}ì— ëŒ€í•œ ì •ë¦¬`,duration:(e.duration||5)/3,visualStyle:e.style||"professional",audioType:"voice_main",narration:`${e.prompt}ì— ëŒ€í•œ ë‚´ìš©ì„ ë§ˆë¬´ë¦¬í•©ë‹ˆë‹¤.`,camera:"wide_shot",transition:"fade_out"}];return{storyId:t,title:`${e.prompt} - ìë™ ìƒì„± ì˜ìƒ`,style:e.style,targetAudience:e.targetAudience,totalDuration:e.duration,scenes:r,narration:r.map(e=>e.narration).join(" "),transitions:p(r),qualityScore:40,fallbackUsed:!0,enhancedMetadata:{scriptQuality:40,sceneCount:3,averageSceneDuration:Math.round((e.duration||5)/3),styleConsistency:100,narrativeFlow:60,language:e.language||"korean",quality:"standard"}}}(e)}}function p(e){return e.map((t,r)=>({from:0===r?null:e[r-1].sceneNumber,to:t.sceneNumber,type:t.transition,duration:.5})).filter(e=>null!==e.from)}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/video/story/route",pathname:"/api/video/story",filename:"route",bundlePath:"app/api/video/story/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\video\\story\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:h}=m,f="/api/video/story/route";function v(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972,1258,4837],()=>r(9479));module.exports=n})();