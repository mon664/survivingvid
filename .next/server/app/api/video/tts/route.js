"use strict";(()=>{var e={};e.id=1640,e.ids=[1640],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3603:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>P,patchFetch:()=>I,requestAsyncStorage:()=>A,routeModule:()=>E,serverHooks:()=>v,staticGenerationAsyncStorage:()=>f});var o={};s.r(o),s.d(o,{GET:()=>m,POST:()=>S});var r=s(9303),a=s(8716),n=s(670),i=s(7070);function l(){let e=process.env.GOOGLE_CLOUD_API_KEY,t=process.env.GOOGLE_AI_API_KEY,s=t||e;if(!s||s.length<10)throw Error("Google TTS API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í™˜ê²½ ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.");return console.log(`ğŸ”‘ TTS API Key source: ${t===s?"GOOGLE_AI_API_KEY":"fallback"}`),s}let u={MAX_TEXT_LENGTH:4800,MIN_SPEED:.25,MAX_SPEED:4,DEFAULT_SPEED:1,REQUEST_TIMEOUT:3e4},c={male:{languageCode:"ko-KR",name:"ko-KR-Standard-C",ssmlGender:"MALE",description:"ë‚¨ì„± ëª©ì†Œë¦¬"},female:{languageCode:"ko-KR",name:"ko-KR-Standard-A",ssmlGender:"FEMALE",description:"ì—¬ì„± ëª©ì†Œë¦¬"},neutral:{languageCode:"ko-KR",name:"ko-KR-Standard-B",ssmlGender:"NEUTRAL",description:"ì¤‘ë¦½ì  ëª©ì†Œë¦¬"},professional:{languageCode:"ko-KR",name:"ko-KR-Wavenet-A",ssmlGender:"FEMALE",description:"ì „ë¬¸ì  ì—¬ì„± ëª©ì†Œë¦¬ (ê³ í’ˆì§ˆ)"},friendly:{languageCode:"ko-KR",name:"ko-KR-Wavenet-B",ssmlGender:"MALE",description:"ì¹œê·¼í•œ ë‚¨ì„± ëª©ì†Œë¦¬ (ê³ í’ˆì§ˆ)"}};function g(e,t){let s={400:"ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤. ì…ë ¥ í…ìŠ¤íŠ¸ë‚˜ íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.",401:"API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.",403:"API ì‚¬ìš©ëŸ‰ì´ ì´ˆê³¼ë˜ì—ˆê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.",429:"API í˜¸ì¶œ ì œí•œì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.",500:"Google TTS ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.",502:"ì„œë²„ ê°„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",503:"ì„œë¹„ìŠ¤ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};return t&&s[t]?s[t]:e instanceof Error?"AbortError"===e.name?"TTS ìƒì„± ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë” ì§§ì€ í…ìŠ¤íŠ¸ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.":e.message.includes("quota")?"API ì‚¬ìš©ëŸ‰ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.":e.message.includes("permission")?"API ì‚¬ìš© ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.":e.message:"ì•Œ ìˆ˜ ì—†ëŠ” TTS ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}async function d(){try{let e=l();if(!e||e.length<20)return{available:!1,message:"Google TTS API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."};let t=await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:"test"},voice:c.female,audioConfig:{audioEncoding:"MP3",speakingRate:1}}),signal:AbortSignal.timeout(1e4)});if(t.ok){let e=await t.json();if(e.audioContent)return{available:!0,message:"Google TTS APIê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤."};return{available:!1,message:"TTS API ì‘ë‹µì— ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.",details:{response:e}}}{let e=await t.text(),s=e?JSON.parse(e):{};return{available:!1,message:g(e,t.status),details:{status:t.status,error:e,errorCode:s.error?.code||"UNKNOWN",errorDetails:s.error?.message||"No details"}}}}catch(e){return{available:!1,message:`TTS API ì—°ê²° ì‹¤íŒ¨: ${e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`,details:e}}}class p{static getInstance(){return p.instance||(p.instance=new p),p.instance}increment(){this.usageCount++}getUsageStats(){let e=Date.now(),t=(e-this.lastReset)/36e5;return t>=24&&(this.usageCount=0,this.lastReset=e),{count:this.usageCount,lastReset:new Date(this.lastReset),hoursSinceReset:t}}constructor(){this.usageCount=0,this.lastReset=Date.now()}}let T=p.getInstance();async function m(e){console.log("\uD83D\uDD0D TTS API ìƒíƒœ í™•ì¸ ìš”ì²­");try{let e=T.getUsageStats(),t=await d();return i.NextResponse.json({status:"online",service:"Google Text-to-Speech API",version:"v1",available:t.available,message:t.message,features:{voiceTypes:Object.keys(c),voiceDetails:Object.entries(c).map(([e,t])=>({type:e,name:t.name,description:t.description,gender:t.ssmlGender})),limits:{maxTextLength:u.MAX_TEXT_LENGTH,speedRange:{min:u.MIN_SPEED,max:u.MAX_SPEED},requestTimeout:u.REQUEST_TIMEOUT},supportedLanguages:["ko-KR"],audioFormats:["MP3"],audioQuality:"High (WaveNet voices available)"},usage:{requests24h:e.count,lastReset:e.lastReset,hoursSinceReset:e.hoursSinceReset},configuration:{hasApiKey:!!process.env.GOOGLE_AI_API_KEY,projectId:process.env.GOOGLE_CLOUD_PROJECT_ID||"Not configured"},timestamp:new Date().toISOString()})}catch(e){return console.error("âŒ TTS ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:",e),i.NextResponse.json({status:"error",message:"TTS ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",error:g(e),timestamp:new Date().toISOString()},{status:500})}}async function S(e){console.log("\uD83C\uDFA4 TTS API ìš”ì²­ ìˆ˜ì‹ ");try{let{text:t,voiceType:s,speed:o}=await e.json();console.log(`ğŸ“¥ ìš”ì²­ íŒŒë¼ë¯¸í„°: text=${t?.substring(0,50)}..., voiceType=${s}, speed=${o}`);let r=function(e,t,s){let o=[];if(e&&"string"==typeof e){let t=e.trim();0===t.length?o.push("í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."):t.length>u.MAX_TEXT_LENGTH&&o.push(`í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ìµœëŒ€ ${u.MAX_TEXT_LENGTH}ìê¹Œì§€ í—ˆìš©ë©ë‹ˆë‹¤.`)}else o.push("í…ìŠ¤íŠ¸ê°€ í•„ìš”í•˜ë©° ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.");t&&!Object.keys(c).includes(t)&&o.push(`ìœ íš¨í•˜ì§€ ì•Šì€ ìŒì„± íƒ€ì…ì…ë‹ˆë‹¤. ì‚¬ìš© ê°€ëŠ¥í•œ íƒ€ì…: ${Object.keys(c).join(", ")}`);let r=s??u.DEFAULT_SPEED,a=parseFloat(r.toString());return isNaN(a)||a<u.MIN_SPEED||a>u.MAX_SPEED?o.push(`ì†ë„ëŠ” ${u.MIN_SPEED}ì—ì„œ ${u.MAX_SPEED} ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.`):r=a,{isValid:0===o.length,errors:o,normalizedSpeed:r}}(t,s,o);if(!r.isValid)return console.error("âŒ ìš”ì²­ íŒŒë¼ë¯¸í„° ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨:",r.errors),i.NextResponse.json({success:!1,error:r.errors.join("; "),availableVoiceTypes:Object.keys(c)},{status:400});try{console.log("\uD83D\uDD0A Google TTS ìŒì„± ìƒì„± ì‹œì‘..."),T.increment();let e=await h(t,s,r.normalizedSpeed);return console.log("âœ… TTS ìƒì„± ì™„ë£Œ:",{audioUrlLength:e.audioUrl.length,duration:e.duration}),i.NextResponse.json({success:!0,audioUrl:e.audioUrl,duration:e.duration,voiceType:s||"female",textLength:t.length,requestedSpeed:r.normalizedSpeed,timestamp:new Date().toISOString()})}catch(t){console.error("âŒ Google TTS ì‹¤íŒ¨:",t);let e=g(t);return i.NextResponse.json({success:!1,error:"ìŒì„± í•©ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",details:e,suggestion:"í…ìŠ¤íŠ¸ ê¸¸ì´ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.",timestamp:new Date().toISOString()},{status:500})}}catch(t){console.error("âŒ TTS API ì²˜ë¦¬ ì˜¤ë¥˜:",t);let e="ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";return e=t instanceof SyntaxError?"ì˜ëª»ëœ JSON í˜•ì‹ì˜ ìš”ì²­ì…ë‹ˆë‹¤.":g(t),i.NextResponse.json({success:!1,error:e,timestamp:new Date().toISOString()},{status:500})}}async function h(e,t="female",s=1){try{let o=l();console.log(`ğŸ”‘ Google TTS API í‚¤ ì‚¬ìš©: ${o.substring(0,8)}...`);let r=c[t]||c.female;console.log(`ğŸ¤ ì„ íƒëœ ìŒì„±: ${r.name} (${r.description})`);let a={input:{text:e.trim()},voice:{languageCode:r.languageCode,name:r.name,ssmlGender:r.ssmlGender},audioConfig:{audioEncoding:"MP3",speakingRate:s,pitch:0,sampleRateHertz:22050,effectsProfileId:["headphone-class-device"]}};console.log(`ğŸ“¤ Google TTS API í˜¸ì¶œ: í…ìŠ¤íŠ¸ ê¸¸ì´=${e.length}, ì†ë„=${s}`);let n=await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${o}`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"SurvivingVid-TTS/1.0"},body:JSON.stringify(a),signal:AbortSignal.timeout(u.REQUEST_TIMEOUT)});if(!n.ok){let e=await n.text(),t=g(e,n.status);throw console.error(`âŒ TTS API ì˜¤ë¥˜ (${n.status}):`,e),Error(t)}let i=await n.json(),d=i.audioContent;if(!d)throw console.error("âŒ TTS ì‘ë‹µì— ì˜¤ë””ì˜¤ ë°ì´í„° ì—†ìŒ:",i),Error("TTS ì‘ë‹µì— ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");let p=function(e){if(!e||"string"!=typeof e)return{isValid:!1,error:"ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ë¬¸ìì—´ì´ ì•„ë‹™ë‹ˆë‹¤."};if(e.length<100)return{isValid:!1,error:"ìƒì„±ëœ ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ë„ˆë¬´ ì‘ìŠµë‹ˆë‹¤."};try{let t=atob(e);if(0===t.length)return{isValid:!1,error:"ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."}}catch(e){return{isValid:!1,error:"ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ Base64 í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤."}}return{isValid:!0,size:e.length}}(d);if(!p.isValid)throw Error(p.error);let T=`data:audio/mp3;base64,${d}`,m=function(e,t){let s=e.trim().length;return Math.max(1,Math.ceil(.08*s/t))}(e,s);return console.log(`âœ… TTS ìƒì„± ì„±ê³µ: ì˜¤ë””ì˜¤ í¬ê¸°=${p.size}B, ì˜ˆìƒ ì¬ìƒì‹œê°„=${m}ì´ˆ`),{audioUrl:T,duration:m}}catch(e){throw console.error("âŒ Google TTS ìš”ì²­ ì‹¤íŒ¨:",e),Error(g(e))}}let E=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/video/tts/route",pathname:"/api/video/tts",filename:"route",bundlePath:"app/api/video/tts/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\video\\tts\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:A,staticGenerationAsyncStorage:f,serverHooks:v}=E,P="/api/video/tts/route";function I(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:f})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[9276,5972],()=>s(3603));module.exports=o})();