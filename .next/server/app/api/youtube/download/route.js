"use strict";(()=>{var t={};t.id=4909,t.ids=[4909],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:t=>{t.exports=require("child_process")},629:t=>{t.exports=require("fs/promises")},5315:t=>{t.exports=require("path")},1764:t=>{t.exports=require("util")},4257:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>R,routeModule:()=>D,serverHooks:()=>b,staticGenerationAsyncStorage:()=>S});var o={};r.r(o),r.d(o,{GET:()=>C,POST:()=>m});var i=r(9303),n=r(8716),a=r(670),s=r(7070),u=r(1282),d=r(1764),l=r(5315),c=r.n(l),p=r(629),w=r.n(p),y=r(7677),h=r(8311);let g=(0,d.promisify)(u.exec);async function m(t){try{let e=await t.json();if(!e.url)return s.NextResponse.json({error:"URL 필드가 필요합니다."},{status:400});if(!e.userId)return s.NextResponse.json({error:"사용자 ID가 필요합니다."},{status:400});let{url:r,quality:o="720p",format:i="mp4",userId:n}=e;try{await g("yt-dlp --version")}catch(t){return s.NextResponse.json({error:"yt-dlp가 설치되지 않았습니다. 먼저 설치해주세요.",installInstructions:"pip install yt-dlp 또는 npm install yt-dlp"},{status:500})}let a=(0,y.Z)(),u=c().join(process.cwd(),"downloads"),d=c().join(u,a);if(await w().mkdir(d,{recursive:!0}),!await h.x.canAfford(n,"download_youtube",1))return s.NextResponse.json({error:"크레딧이 부족합니다. (S-CRD 1개 필요)"},{status:400});let l=await f(r);if(!l)return s.NextResponse.json({error:"비디오 정보를 가져올 수 없습니다."},{status:400});let p="",m="";"mp3"===i||"audio-only"===o?(m=`${a}/audio.%(ext)s`,p=`yt-dlp --extract-audio --audio-format mp3 --audio-quality 0 -o "${m}" "${r}"`):(m=`${a}/video.%(ext)s`,p=`yt-dlp -f "${({"360p":"worst[height<=360]","720p":"worst[height<=720]","1080p":"worst[height<=1080]",highest:"best"})[o]||"worst[height<=720]"}" -o "${m}" "${r}"`),console.log(`다운로드 시작: ${r}`);let{stdout:C,stderr:D}=await g(p,{cwd:u,timeout:3e5});if(D&&!D.includes("100%"))return console.error("다운로드 오류:",D),s.NextResponse.json({error:"다운로드에 실패했습니다.",details:D},{status:500});let R=(await w().readdir(d)).find(t=>t.endsWith(".mp4")||t.endsWith(".mp3")||t.endsWith(".webm"));if(!R)return s.NextResponse.json({error:"다운로드된 파일을 찾을 수 없습니다."},{status:500});let S=c().join(d,R),b=await w().stat(S);try{await h.x.spendCredits(n,"download_youtube",1,{url:r,downloadId:a,fileName:R,fileSize:b.size})}catch(t){console.error("크레딧 차감 오류:",t)}return s.NextResponse.json({success:!0,data:{downloadId:a,metadata:l,fileInfo:{fileName:R,filePath:S,fileSize:b.size,format:i,quality:o}}})}catch(t){return console.error("YouTube 다운로드 API 오류:",t),s.NextResponse.json({error:"다운로드에 실패했습니다.",details:t instanceof Error?t.message:"알 수 없는 오류"},{status:500})}}async function C(){return s.NextResponse.json({message:"SurvivingVid YouTube 다운로드 API",endpoints:{POST:"/api/youtube/download",description:"yt-dlp를 사용한 YouTube 비디오/오디오 다운로드"},usage:{url:"string (필수) - YouTube 비디오 URL",quality:"string (선택) - 비디오 품질 (360p, 720p, 1080p, highest, audio-only)",format:"string (선택) - 파일 형식 (mp4, mp3, webm)"},examples:{download:{url:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",quality:"720p",format:"mp4"},audioOnly:{url:"https://www.youtube.com/watch?v=dQw4w9WgXcQ",quality:"audio-only",format:"mp3"}},requirements:{"yt-dlp":"yt-dlp가 시스템에 설치되어 있어야 합니다",permissions:"다운로드 디렉토리에 쓰기 권한 필요"}})}async function f(t){try{let e=`yt-dlp --dump-json --no-download "${t}"`,{stdout:r}=await g(e),o=JSON.parse(r);return{title:o.title||"Unknown Title",description:o.description||"",duration:o.duration||"0:00",uploader:o.uploader||"Unknown Uploader",uploadDate:o.upload_date||"",viewCount:o.view_count?.toString()||"0",thumbnailUrl:o.thumbnail||"",durationSeconds:o.duration||0}}catch(e){console.error("메타데이터 추출 오류:",e);try{let e=`yt-dlp --get-title --get-description --get-duration --get-uploader --get-upload-date --get-view-count --get-thumbnail "${t}"`,{stdout:r}=await g(e),o=r.split("\n");return{title:o[0]?.replace("Title: ","")||"Unknown Title",description:o[1]?.replace("Description: ","")||"",duration:o[2]?.replace("Duration: ","")||"0:00",uploader:o[3]?.replace("Uploader: ","")||"Unknown Uploader",uploadDate:o[4]?.replace("Upload date: ","")||"",viewCount:o[5]?.replace("View count: ","")||"0",thumbnailUrl:o[6]?.replace("Thumbnail: ","")||"",durationSeconds:0}}catch(t){return console.error("기본 메타데이터 추출 실패:",t),null}}}let D=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/youtube/download/route",pathname:"/api/youtube/download",filename:"route",bundlePath:"app/api/youtube/download/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\youtube\\download\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:R,staticGenerationAsyncStorage:S,serverHooks:b}=D,x="/api/youtube/download/route";function v(){return(0,a.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:S})}},7677:(t,e,r)=>{r.d(e,{Z:()=>d});let o=require("crypto");var i=r.n(o);let n={randomUUID:i().randomUUID},a=new Uint8Array(256),s=a.length,u=[];for(let t=0;t<256;++t)u.push((t+256).toString(16).slice(1));let d=function(t,e,r){if(n.randomUUID&&!e&&!t)return n.randomUUID();let o=(t=t||{}).random||(t.rng||function(){return s>a.length-16&&(i().randomFillSync(a),s=0),a.slice(s,s+=16)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=o[t];return e}return function(t,e=0){return u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]}(o)}},8311:(t,e,r)=>{r.d(e,{x:()=>o});class o{static{this.COSTS={generate_script:{action:"AI 스크립트 생성",cost:{"S-CRD":1,"E-CRD":0},description:"AI 기반 영상 스크립트 생성"},generate_images:{action:"AI 이미지 생성",cost:{"S-CRD":1,"E-CRD":0},description:"이미지 1개 생성당"},render_video:{action:"영상 렌더링",cost:{"S-CRD":2,"E-CRD":0},description:"영상 1개 렌더링"},download_youtube:{action:"YouTube 다운로드",cost:{"S-CRD":1,"E-CRD":0},description:"YouTube 영상 다운로드"},export_high_quality:{action:"고품질 내보내기",cost:{"S-CRD":0,"E-CRD":1},description:"고화질/고프레임 렌더링"}}}static{this.DEMO_CREDITS={"S-CRD":100,"E-CRD":50,total:150,lastUpdated:new Date}}static async getCreditBalance(t){return{...this.DEMO_CREDITS}}static async canAfford(t,e,r=1){try{let o=await this.getCreditBalance(t),i=this.COSTS[e];if(!i)throw Error(`알 수 없는 액션: ${e}`);let n=i.cost["S-CRD"]*r,a=i.cost["E-CRD"]*r;return o["S-CRD"]>=n&&o["E-CRD"]>=a}catch(t){return console.error("크레딧 확인 오류:",t),!1}}static async spendCredits(t,e,r=1,o){let i=this.COSTS[e];if(!i)throw Error(`알 수 없는 액션: ${e}`);let n=i.cost["S-CRD"]*r,a=i.cost["E-CRD"]*r;if(!await this.canAfford(t,e,r))throw Error("크레딧이 부족합니다.");let s=await this.getCreditBalance(t);return{id:`demo_${Date.now()}`,userId:t,type:"spend",amount:n+a,creditType:a>0?"E-CRD":"S-CRD",description:`${i.description} (${r}개)`,category:this.getCategoryFromAction(e),metadata:{...o,action:e,quantity:r,cost_breakdown:i.cost},balance:{"S-CRD":s["S-CRD"],"E-CRD":s["E-CRD"]},createdAt:new Date}}static async addCredits(t,e,r,o,i){let n=await this.getCreditBalance(t);return{id:`demo_${Date.now()}`,userId:t,type:"earn",amount:e,creditType:r,description:o,category:i?.category||"bonus",metadata:i,balance:n,createdAt:new Date}}static async getTransactionHistory(t,e=50){return[]}static getCategoryFromAction(t){return({generate_script:"script",generate_images:"image",render_video:"video",download_youtube:"video",export_high_quality:"video"})[t]||"other"}static getAvailableActions(){return{...this.COSTS}}static async giveDailyLoginBonus(t){return!1}}}};var e=require("../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),o=e.X(0,[9276,5972],()=>r(4257));module.exports=o})();