"use strict";(()=>{var t={};t.id=4050,t.ids=[4050],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1282:t=>{t.exports=require("child_process")},2048:t=>{t.exports=require("fs")},5315:t=>{t.exports=require("path")},1764:t=>{t.exports=require("util")},3749:(t,e,r)=>{r.r(e),r.d(e,{originalPathname:()=>I,patchFetch:()=>O,requestAsyncStorage:()=>v,routeModule:()=>C,serverHooks:()=>x,staticGenerationAsyncStorage:()=>_});var a={};r.r(a),r.d(a,{GET:()=>b,POST:()=>S});var o=r(9303),i=r(8716),s=r(670),n=r(7070),u=r(1282),c=r(1764),l=r(5315),d=r.n(l),p=r(2048),g=r.n(p),h=r(7677),f=r(8311);let y=(0,c.promisify)(u.exec),m=async()=>{try{return await y("yt-dlp --version"),!0}catch(t){return!1}};class D{static{this.DOWNLOAD_DIR=d().join(process.cwd(),"downloads")}static{this.PROGRESS_FILE="youtube-progress.json"}static{g().existsSync(this.DOWNLOAD_DIR)||g().mkdirSync(this.DOWNLOAD_DIR,{recursive:!0})}static async getVideoInfo(t){if(!await m())throw Error("yt-dlp가 설치되어 있지 않습니다. YouTube 다운로더 기능을 사용하려면 yt-dlp를 설치해주세요.");try{let e=`yt-dlp --dump-json --no-download "${t}"`,{stdout:r}=await y(e),a=JSON.parse(r);return{id:a.id,title:a.title||"제목 없음",description:a.description||"",duration:a.duration||0,durationFormatted:this.formatDuration(a.duration||0),uploader:a.uploader||"알 수 없음",uploaderId:a.uploader_id||"",uploadDate:a.upload_date||"",viewCount:a.view_count||0,likeCount:a.like_count||0,thumbnail:a.thumbnail||"",thumbnails:a.thumbnails||[],formats:this.parseFormats(a.formats||[]),audioFormats:this.parseFormats(a.formats?.filter(t=>t.acodec&&"none"!==t.acodec)||[]),videoFormats:this.parseFormats(a.formats?.filter(t=>t.vcodec&&"none"!==t.vcodec)||[]),fileSize:a.filesize||0,fileSizeHuman:this.formatFileSize(a.filesize||0),tags:a.tags||[],category:a.categories?.[0]||"",language:a.language||""}}catch(t){throw console.error("YouTube 영상 정보 추출 오류:",t),Error("YouTube 영상 정보를 가져올 수 없습니다.")}}static async startDownload(t,e,r){if(!await m())throw Error("yt-dlp가 설치되어 있지 않습니다. YouTube 다운로더 기능을 사용하려면 yt-dlp를 설치해주세요.");let a=(0,h.Z)(),o={id:a,url:t,status:"pending",progress:0,speed:0,eta:0,downloadedBytes:0,totalBytes:0,filename:"",createdAt:new Date};return await this.saveProgress(a,o),this.downloadInBackground(a,t,e,r),o}static async downloadInBackground(t,e,r,a){try{await this.updateProgress(t,{status:"downloading",progress:0});let o=`${t}_${Date.now()}.${r.container}`,i=d().join(this.DOWNLOAD_DIR,o),s=`yt-dlp "${e}" -o "${i}"`;r.formatId?s+=` -f "${r.formatId}"`:"audio"===r.type?s+=" -f bestaudio":"video"===r.type&&(s+=` -f "best[height<=${"highest"===r.quality?"1080":"medium"===r.quality?"720":"360"}] + bestaudio/best"`),s+=` --merge-output-format ${r.container}`;let n=(0,u.exec)(s),c=0;n.stdout?.on("data",e=>{let r=e.toString(),a=r.match(/(\d+(?:\.\d+)?)%/),o=r.match(/(\d+(?:\.\d+)?)KiB\/s/),i=r.match(/ETA\s+(\d+):(\d+)/);if(a){let e=parseFloat(a[1]);e-c>=10&&(this.updateProgress(t,{progress:e,speed:o?1024*parseFloat(o[1]):0,eta:i?60*parseInt(i[1])+parseInt(i[2]):0}),c=e)}}),n.on("close",async r=>{if(0===r){try{await f.x.spendCredits(a,"download_youtube",1,{url:e,downloadId:t,filename:o})}catch(t){console.error("크레딧 차감 오류:",t)}let r=g().statSync(i);await this.updateProgress(t,{status:"completed",progress:100,downloadedBytes:r.size,totalBytes:r.size,filename:o,completedAt:new Date})}else await this.updateProgress(t,{status:"error",error:`다운로드 실패 (종료 코드: ${r})`})}),n.on("error",async e=>{await this.updateProgress(t,{status:"error",error:e.message})})}catch(e){await this.updateProgress(t,{status:"error",error:e instanceof Error?e.message:"알 수 없는 오류"})}}static async getProgress(t){try{let e=d().join(this.DOWNLOAD_DIR,`${t}.json`);if(!g().existsSync(e))return null;let r=g().readFileSync(e,"utf8");return JSON.parse(r)}catch(t){return console.error("진행 상태 조회 오류:",t),null}}static async saveProgress(t,e){try{let r=d().join(this.DOWNLOAD_DIR,`${t}.json`);g().writeFileSync(r,JSON.stringify(e,null,2))}catch(t){console.error("진행 상태 저장 오류:",t)}}static async updateProgress(t,e){try{let r=await this.getProgress(t);if(!r)return;let a={...r,...e};await this.saveProgress(t,a)}catch(t){console.error("진행 상태 업데이트 오류:",t)}}static async cancelDownload(t){try{await this.updateProgress(t,{status:"cancelled"});let e=await this.getProgress(t);if(e&&e.filename){let t=d().join(this.DOWNLOAD_DIR,e.filename);g().existsSync(t)&&g().unlinkSync(t)}return!0}catch(t){return console.error("다운로드 취소 오류:",t),!1}}static async getDownloadList(t){try{let e=g().readdirSync(this.DOWNLOAD_DIR).filter(t=>t.endsWith(".json")),r=[];for(let a of e)try{let e=d().join(this.DOWNLOAD_DIR,a),o=g().readFileSync(e,"utf8"),i=JSON.parse(o);(!t||i.filename.includes(t))&&r.push(i)}catch(t){console.error("파일 읽기 오류:",a,t)}return r.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())}catch(t){return console.error("다운로드 목록 조회 오류:",t),[]}}static parseFormats(t){return t.map(t=>({formatId:t.format_id,ext:t.ext,resolution:t.resolution||`${t.width}x${t.height}`,fps:t.fps||0,filesize:t.filesize||0,filesizeHuman:this.formatFileSize(t.filesize||0),tbr:t.tbr||0,vcodec:t.vcodec||"none",acodec:t.acodec||"none",container:t.container||t.ext,quality:t.quality||t.format_note||""}))}static formatDuration(t){let e=Math.floor(t/3600),r=Math.floor(t%3600/60),a=Math.floor(t%60);return e>0?`${e}:${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${r}:${a.toString().padStart(2,"0")}`}static formatFileSize(t){if(0===t)return"0 B";let e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["B","KB","MB","GB"][e]}static isValidYouTubeUrl(t){return/^https?:\/\/(www\.)?(youtube\.com\/(watch\?v=|embed\/|v\/)|youtu\.be\/|youtube\.com\/playlist\?list=)/.test(t)}static extractVideoId(t){let e=t.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)([a-zA-Z0-9_-]{11})/);return e?e[1]:null}}let w=(0,c.promisify)(u.exec);async function S(t){try{let e=await t.json();if(!e.url)return n.NextResponse.json({error:"URL 필드가 필요합니다."},{status:400});if(!D.isValidYouTubeUrl(e.url))return n.NextResponse.json({error:"유효한 YouTube URL이 아닙니다."},{status:400});let r=await D.getVideoInfo(e.url);return n.NextResponse.json({success:!0,data:r})}catch(r){console.error("YouTube 정보 API 오류:",r);let e=await t.json();try{let t=await R(e.url);if(!t)return n.NextResponse.json({error:"비디오 정보를 가져올 수 없습니다."},{status:400});return n.NextResponse.json({success:!0,data:t})}catch(t){return n.NextResponse.json({error:"비디오 정보를 가져오는 데 실패했습니다.",details:r instanceof Error?r.message:"알 수 없는 오류"},{status:500})}}}async function b(){return n.NextResponse.json({message:"SurvivingVid YouTube 정보 API",endpoints:{POST:"/api/youtube/info",description:"YouTube 비디오 메타데이터 추출"},usage:{url:"string (필수) - YouTube 비디오 URL"}})}async function R(t){try{let e=`yt-dlp --dump-json --no-download "${t}"`,{stdout:r}=await w(e),a=JSON.parse(r);return{id:a.id||"",title:a.title||"",description:a.description||"",duration:a.duration||0,durationString:function(t){let e=Math.floor(t/3600),r=Math.floor(t%3600/60),a=Math.floor(t%60);return e>0?`${e}:${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${r}:${a.toString().padStart(2,"0")}`}(a.duration||0),uploader:a.uploader||"",uploaderId:a.uploader_id||"",uploadDate:a.upload_date||"",viewCount:a.view_count||0,likeCount:a.like_count||0,thumbnailUrl:a.thumbnail||"",thumbnails:a.thumbnails||[],formats:a.formats?.map(t=>({formatId:t.format_id||"",ext:t.ext||"",resolution:t.resolution||"",fps:t.fps||0,filesize:t.filesize||0,url:t.url||""}))||[],tags:a.tags||[],category:a.category||"",language:a.language||""}}catch(e){console.error("메타데이터 추출 오류:",e);try{let e=`yt-dlp --get-title --get-description --get-duration --get-uploader --get-upload-date --get-view-count --get-thumbnail --get-format "${t}"`,{stdout:r}=await w(e),a=r.split("\n"),o=a.find(t=>t.includes("Format code")),i=["360p","480p","720p","1080p","2160p"].filter(t=>o?.includes(t)||r.includes(t));return{id:t.split("v=")[1]?.split("&")[0]||"",title:a[0]?.replace("Title: ","")||"",description:a[1]?.replace("Description: ","")||"",duration:0,durationString:a[2]?.replace("Duration: ","")||"",uploader:a[3]?.replace("Uploader: ","")||"",uploaderId:"",uploadDate:a[4]?.replace("Upload date: ","")||"",viewCount:parseInt(a[5]?.replace("View count: ","")||"0",10),likeCount:0,thumbnailUrl:a[6]?.replace("Thumbnail: ","")||"",thumbnails:[],formats:i.map(e=>({formatId:e,ext:"mp4",resolution:e,fps:30,filesize:0,url:t})),tags:[],category:"",language:""}}catch(t){return console.error("기본 정보 추출 실패:",t),null}}}let C=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/youtube/info/route",pathname:"/api/youtube/info",filename:"route",bundlePath:"app/api/youtube/info/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\youtube\\info\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:v,staticGenerationAsyncStorage:_,serverHooks:x}=C,I="/api/youtube/info/route";function O(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:_})}},7677:(t,e,r)=>{r.d(e,{Z:()=>c});let a=require("crypto");var o=r.n(a);let i={randomUUID:o().randomUUID},s=new Uint8Array(256),n=s.length,u=[];for(let t=0;t<256;++t)u.push((t+256).toString(16).slice(1));let c=function(t,e,r){if(i.randomUUID&&!e&&!t)return i.randomUUID();let a=(t=t||{}).random||(t.rng||function(){return n>s.length-16&&(o().randomFillSync(s),n=0),s.slice(n,n+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){r=r||0;for(let t=0;t<16;++t)e[r+t]=a[t];return e}return function(t,e=0){return u[t[e+0]]+u[t[e+1]]+u[t[e+2]]+u[t[e+3]]+"-"+u[t[e+4]]+u[t[e+5]]+"-"+u[t[e+6]]+u[t[e+7]]+"-"+u[t[e+8]]+u[t[e+9]]+"-"+u[t[e+10]]+u[t[e+11]]+u[t[e+12]]+u[t[e+13]]+u[t[e+14]]+u[t[e+15]]}(a)}},8311:(t,e,r)=>{r.d(e,{x:()=>a});class a{static{this.COSTS={generate_script:{action:"AI 스크립트 생성",cost:{"S-CRD":1,"E-CRD":0},description:"AI 기반 영상 스크립트 생성"},generate_images:{action:"AI 이미지 생성",cost:{"S-CRD":1,"E-CRD":0},description:"이미지 1개 생성당"},render_video:{action:"영상 렌더링",cost:{"S-CRD":2,"E-CRD":0},description:"영상 1개 렌더링"},download_youtube:{action:"YouTube 다운로드",cost:{"S-CRD":1,"E-CRD":0},description:"YouTube 영상 다운로드"},export_high_quality:{action:"고품질 내보내기",cost:{"S-CRD":0,"E-CRD":1},description:"고화질/고프레임 렌더링"}}}static{this.DEMO_CREDITS={"S-CRD":100,"E-CRD":50,total:150,lastUpdated:new Date}}static async getCreditBalance(t){return{...this.DEMO_CREDITS}}static async canAfford(t,e,r=1){try{let a=await this.getCreditBalance(t),o=this.COSTS[e];if(!o)throw Error(`알 수 없는 액션: ${e}`);let i=o.cost["S-CRD"]*r,s=o.cost["E-CRD"]*r;return a["S-CRD"]>=i&&a["E-CRD"]>=s}catch(t){return console.error("크레딧 확인 오류:",t),!1}}static async spendCredits(t,e,r=1,a){let o=this.COSTS[e];if(!o)throw Error(`알 수 없는 액션: ${e}`);let i=o.cost["S-CRD"]*r,s=o.cost["E-CRD"]*r;if(!await this.canAfford(t,e,r))throw Error("크레딧이 부족합니다.");let n=await this.getCreditBalance(t);return{id:`demo_${Date.now()}`,userId:t,type:"spend",amount:i+s,creditType:s>0?"E-CRD":"S-CRD",description:`${o.description} (${r}개)`,category:this.getCategoryFromAction(e),metadata:{...a,action:e,quantity:r,cost_breakdown:o.cost},balance:{"S-CRD":n["S-CRD"],"E-CRD":n["E-CRD"]},createdAt:new Date}}static async addCredits(t,e,r,a,o){let i=await this.getCreditBalance(t);return{id:`demo_${Date.now()}`,userId:t,type:"earn",amount:e,creditType:r,description:a,category:o?.category||"bonus",metadata:o,balance:i,createdAt:new Date}}static async getTransactionHistory(t,e=50){return[]}static getCategoryFromAction(t){return({generate_script:"script",generate_images:"image",render_video:"video",download_youtube:"video",export_high_quality:"video"})[t]||"other"}static getAvailableActions(){return{...this.COSTS}}static async giveDailyLoginBonus(t){return!1}}}};var e=require("../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[9276,5972],()=>r(3749));module.exports=a})();