"use strict";(()=>{var e={};e.id=4790,e.ids=[4790],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6720:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>b,patchFetch:()=>S,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var a={};s.r(a),s.d(a,{GET:()=>g,POST:()=>m});var r=s(9303),i=s(8716),n=s(670),o=s(7070),c=s(4837),l=s(1645),u=s(4225);let h=new Map;async function m(e){let t=`script_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s=Date.now();try{console.log(`ğŸ¬ [${t}] ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ìš”ì²­ ì‹œì‘`);let a=function(e){let t=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown",s=e.headers.get("user-agent")||"unknown";return!s||s.length<10?{isValid:!1,error:"ìœ íš¨í•˜ì§€ ì•Šì€ User-Agent"}:{isValid:!0,clientIp:t}}(e);if(!a.isValid)return console.warn(`âš ï¸ [${t}] ë³´ì•ˆ ê²€ì¦ ì‹¤íŒ¨: ${a.error}`),o.NextResponse.json({success:!1,error:"ë³´ì•ˆ ê²€ì¦ ì‹¤íŒ¨",details:a.error,requestId:t},{status:403,headers:{"X-Request-ID":t,"Retry-After":"60"}});if(a.clientIp){let e=function(e){let t=Date.now(),s=h.get(e);return!s||t>s.resetTime?(h.set(e,{count:1,resetTime:t+6e4}),{allowed:!0}):s.count>=10?{allowed:!1,error:"ìš”ì²­ ì†ë„ ì œí•œì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤",retryAfter:Math.ceil((s.resetTime-t)/1e3)}:(s.count++,{allowed:!0})}(a.clientIp);if(!e.allowed)return console.warn(`âš ï¸ [${t}] ì†ë„ ì œí•œ ì´ˆê³¼: ${a.clientIp}`),o.NextResponse.json({success:!1,error:"ìš”ì²­ ì†ë„ ì œí•œ ì´ˆê³¼",details:e.error,requestId:t},{status:429,headers:{"X-Request-ID":t,"Retry-After":String(e.retryAfter||60)}})}let r=await e.json(),i=function(e){if(!e||"object"!=typeof e)return{isValid:!1,error:"ìœ íš¨í•œ JSON ìš”ì²­ ë³¸ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤."};for(let t of["subject","requestNumber","requestLanguage"])if(!e[t])return{isValid:!1,error:`${t} í•„ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.`};if("string"!=typeof e.subject||0===e.subject.trim().length)return{isValid:!1,error:"ì£¼ì œëŠ” ë¹„ì–´ìˆì§€ ì•Šì€ ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤."};if("number"!=typeof e.requestNumber||e.requestNumber<1||e.requestNumber>20)return{isValid:!1,error:"ìš”ì²­ ìˆ˜ëŠ” 1ì—ì„œ 20 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤."};let t=["ko","en","zh","ja"];return t.includes(e.requestLanguage)?{isValid:!0,sanitizedBody:{subject:e.subject.trim().substring(0,500),requestNumber:Math.min(e.requestNumber,20),requestLanguage:e.requestLanguage,includeOpeningSegment:!!e.includeOpeningSegment,includeClosingSegment:!!e.includeClosingSegment,includeImageGenPrompt:!!e.includeImageGenPrompt,targetAudience:e.targetAudience||"general",style:e.style||"professional",quality:e.quality||"standard",maxTokens:Math.min(e.maxTokens||8192,32768),temperature:Math.max(0,Math.min(e.temperature||.7,2))}}:{isValid:!1,error:`ì§€ì›ë˜ëŠ” ì–¸ì–´: ${t.join(", ")}`}}(r);if(!i.isValid)return console.warn(`âš ï¸ [${t}] ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨: ${i.error}`),o.NextResponse.json({success:!1,error:"ìš”ì²­ ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨",details:i.error,requestId:t},{status:400,headers:{"X-Request-ID":t}});let n=i.sanitizedBody;console.log(`ğŸ¯ [${t}] ìŠ¤í¬ë¦½íŠ¸ ìƒì„± íŒŒë¼ë¯¸í„°:`,{subject:n.subject,requestNumber:n.requestNumber,language:n.requestLanguage,quality:n.quality});let m=function(e){let t={subject:e.subject.trim().toLowerCase(),requestNumber:e.requestNumber,requestLanguage:e.requestLanguage,style:e.style||"professional",quality:e.quality||"standard",includeOpeningSegment:e.includeOpeningSegment,includeClosingSegment:e.includeClosingSegment,includeImageGenPrompt:e.includeImageGenPrompt};return Buffer.from(JSON.stringify(t)).toString("base64")}(n),g=u.Ul.get(m);if(g){let e=Date.now()-s;return console.log(`âœ… [${t}] ìºì‹œ íˆíŠ¸: ìŠ¤í¬ë¦½íŠ¸ ë°˜í™˜ (${e}ms)`),await (0,l.sR)({operationType:"script_generation",responseTime:e,success:!0,model:"gemini-1.5-flash-cache"}),o.NextResponse.json({success:!0,data:g,metadata:{requestId:t,processingTime:e,model:"gemini-1.5-flash-latest",cached:!0,requestParams:{subject:n.subject,requestNumber:n.requestNumber,language:n.requestLanguage,quality:n.quality}}},{headers:{"X-Request-ID":t,"X-Processing-Time":String(e),"X-Cache":"HIT","Cache-Control":"no-cache, no-store, must-revalidate"}})}let d=await (0,c.DG)(n),p=Date.now()-s;console.log(`âœ… [${t}] ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì„±ê³µ: ${p}ms`),u.Ul.set(m,d,{ttl:18e5});let f=d.processingTime?Math.floor(p/100):0;return await (0,l.sR)({operationType:"script_generation",responseTime:p,tokenUsage:f,cost:75e-6*f,success:!0,model:"gemini-1.5-flash"}),o.NextResponse.json({success:!0,data:d,metadata:{requestId:t,processingTime:p,model:"gemini-1.5-flash-latest",requestParams:{subject:n.subject,requestNumber:n.requestNumber,language:n.requestLanguage,quality:n.quality}}},{headers:{"X-Request-ID":t,"X-Processing-Time":String(p),"Cache-Control":"no-cache, no-store, must-revalidate"}})}catch(n){let e=Date.now()-s;console.error(`âŒ [${t}] ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì˜¤ë¥˜:`,{error:n.message,stack:n.stack,processingTime:e}),await (0,l.sR)({operationType:"script_generation",responseTime:e,success:!1,error:n instanceof Error?n.message:"Unknown error",model:"gemini-1.5-flash"});let a=500,r="internal_error",i="ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";return"ValidationError"===n.name?(a=400,r="validation_error",i="ìš”ì²­ ë°ì´í„°ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."):"AuthenticationError"===n.name?(a=401,r="auth_error",i="API ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."):"RateLimitError"===n.name?(a=429,r="rate_limit_error",i="API ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."):"TimeoutError"===n.name&&(a=408,r="timeout_error",i="ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤."),o.NextResponse.json({success:!1,error:i,details:"ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜",errorType:r,requestId:t,metadata:{processingTime:e,timestamp:new Date().toISOString()}},{status:a,headers:{"X-Request-ID":t,"X-Processing-Time":String(e)}})}}async function g(){let e=u.Ul.getStats();return o.NextResponse.json({message:"SurvivingVid ìŠ¤í¬ë¦½íŠ¸ ìƒì„± API",endpoints:{POST:"/api/generate-script",description:"AI ìŠ¤í¬ë¦½íŠ¸ ìƒì„±"},usage:{subject:"string (í•„ìˆ˜) - ì˜ìƒ ì£¼ì œ",requestNumber:"number (í•„ìˆ˜) - ìƒì„±í•  íŒŒíŠ¸ ìˆ˜",requestLanguage:"string (í•„ìˆ˜) - ì–¸ì–´ ì½”ë“œ (ko-KR, en-US)",includeOpeningSegment:"boolean (ì„ íƒ) - ì˜¤í”„ë‹ í¬í•¨ ì—¬ë¶€",includeClosingSegment:"boolean (ì„ íƒ) - í´ë¡œì§• í¬í•¨ ì—¬ë¶€",includeImageGenPrompt:"boolean (ì„ íƒ) - ì´ë¯¸ì§€ ìƒì„± í”„ë¡¬í”„íŠ¸ í¬í•¨ ì—¬ë¶€"},cache:{enabled:!0,stats:e,ttl:"30 minutes"}})}let d=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/generate-script/route",pathname:"/api/generate-script",filename:"route",bundlePath:"app/api/generate-script/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\generate-script\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:y}=d,b="/api/generate-script/route";function S(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},4225:(e,t,s)=>{s.d(t,{I5:()=>r,U_:()=>o,Ul:()=>n,hH:()=>i});class a{constructor(e={}){this.cache=new Map,this.maxSize=e.maxSize||1e3,this.enableMetrics=e.enableMetrics??!0,this.namespace=e.namespace||"default",this.stats={totalEntries:0,hitCount:0,missCount:0,hitRate:0,memoryUsage:0,evictions:0,averageTTL:0},this.cleanupInterval=setInterval(()=>{this.cleanup()},6e4),console.log(`ğŸ—„ï¸ Smart Cache initialized: namespace=${this.namespace}, maxSize=${this.maxSize}`)}set(e,t,s={}){try{let a=this.getNamespacedKey(e),r=s.ttl||3e5,i=Date.now();this.cache.size>=this.maxSize&&!this.cache.has(a)&&this.evictLRU();let n={data:t,timestamp:i,ttl:r,hits:0,lastAccessed:i,metadata:{createdAt:i,namespace:this.namespace}};return this.cache.set(a,n),this.updateStats(),console.log(`ğŸ’¾ Cache SET: ${e} (TTL: ${r}ms)`),!0}catch(e){return console.error("âŒ Cache SET error:",e),!1}}get(e){try{let t=this.getNamespacedKey(e),s=this.cache.get(t);if(!s)return this.recordMiss(),console.log(`ğŸ” Cache MISS: ${e}`),null;let a=Date.now();if(a-s.timestamp>s.ttl)return this.cache.delete(t),this.recordMiss(),console.log(`â° Cache EXPIRED: ${e}`),null;return s.hits++,s.lastAccessed=a,this.recordHit(),console.log(`âœ… Cache HIT: ${e} (hits: ${s.hits})`),s.data}catch(e){return console.error("âŒ Cache GET error:",e),this.recordMiss(),null}}delete(e){let t=this.getNamespacedKey(e),s=this.cache.delete(t);return s&&(console.log(`ğŸ—‘ï¸ Cache DELETE: ${e}`),this.updateStats()),s}has(e){let t=this.getNamespacedKey(e),s=this.cache.get(t);return!!s&&(!(Date.now()-s.timestamp>s.ttl)||(this.cache.delete(t),!1))}clear(){let e=this.cache.size;this.cache.clear(),console.log(`ğŸ§¹ Cache CLEAR: ${e} entries removed`),this.updateStats()}getStats(){return this.updateStats(),{...this.stats}}keys(){let e=Date.now(),t=[];for(let[s,a]of this.cache.entries())e-a.timestamp<=a.ttl&&t.push(s.replace(`${this.namespace}:`,""));return t}async warm(e,t={}){console.log(`ğŸ”¥ Cache warming: ${Object.keys(e).length} entries`);let s=Object.entries(e).map(async([e,s])=>this.set(e,s,t));await Promise.all(s),console.log(`âœ… Cache warming completed`)}mget(e){let t={};for(let s of e)t[s]=this.get(s);return t}mset(e,t={}){for(let[s,a]of Object.entries(e))this.set(s,a,t)}async warmWithFn(e,t,s={}){console.log(`ğŸ”¥ Async cache warming: ${e.length} entries`);let a=e.map(async e=>{try{let a=await t(e);return this.set(e,a,s)}catch(t){return console.error(`âŒ Cache warming failed for key ${e}:`,t),!1}});await Promise.all(a),console.log(`âœ… Async cache warming completed`)}cleanup(){let e=Date.now(),t=0;for(let[s,a]of this.cache.entries())e-a.timestamp>a.ttl&&(this.cache.delete(s),t++);t>0&&(console.log(`ğŸ§¹ Cache cleanup: ${t} expired entries removed`),this.updateStats())}evictLRU(){let e="",t=Date.now();for(let[s,a]of this.cache.entries())a.lastAccessed<t&&(t=a.lastAccessed,e=s);e&&(this.cache.delete(e),this.stats.evictions++,console.log(`ğŸ—‘ï¸ Cache LRU eviction: ${e}`))}getNamespacedKey(e){return`${this.namespace}:${e}`}recordHit(){this.enableMetrics&&(this.stats.hitCount++,this.updateHitRate())}recordMiss(){this.enableMetrics&&(this.stats.missCount++,this.updateHitRate())}updateHitRate(){let e=this.stats.hitCount+this.stats.missCount;this.stats.hitRate=e>0?this.stats.hitCount/e:0}updateStats(){if(!this.enableMetrics)return;this.stats.totalEntries=this.cache.size;let e=0,t=0;for(let s of this.cache.values())e+=2*JSON.stringify(s.data).length,t+=s.ttl;this.stats.memoryUsage=e,this.stats.averageTTL=this.cache.size>0?t/this.cache.size:0}destroy(){this.cleanupInterval&&clearInterval(this.cleanupInterval),this.clear(),console.log(`ğŸ’¥ Cache destroyed: namespace=${this.namespace}`)}}let r=new a({namespace:"default",maxSize:500}),i=new a({namespace:"api",maxSize:200,ttl:3e5}),n=new a({namespace:"scripts",maxSize:100,ttl:18e5}),o=new a({namespace:"images",maxSize:1e3,ttl:36e5})}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9276,5972,1258,4837],()=>s(6720));module.exports=a})();