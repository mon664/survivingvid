"use strict";(()=>{var e={};e.id=3208,e.ids=[3208],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8262:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>D,patchFetch:()=>g,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>l,staticGenerationAsyncStorage:()=>C});var a={};r.r(a),r.d(a,{POST:()=>d});var s=r(9303),i=r(8716),o=r(670),n=r(7070),c=r(8311);async function d(e){try{let{userId:t,action:r,quantity:a=1,metadata:s}=await e.json();if(!t||!r)return n.NextResponse.json({error:"사용자 ID와 액션이 필요합니다."},{status:400});if(!await c.x.canAfford(t,r,a))return n.NextResponse.json({error:"크레딧이 부족합니다."},{status:400});let i=await c.x.spendCredits(t,r,a,s);return n.NextResponse.json({success:!0,data:{transaction:i,remainingBalance:i.balance}})}catch(e){return console.error("크레딧 차감 API 오류:",e),n.NextResponse.json({error:"크레딧 차감에 실패했습니다.",details:e instanceof Error?e.message:"알 수 없는 오류"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/credits/spend/route",pathname:"/api/credits/spend",filename:"route",bundlePath:"app/api/credits/spend/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\credits\\spend\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:C,serverHooks:l}=p,D="/api/credits/spend/route";function g(){return(0,o.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:C})}},8311:(e,t,r)=>{r.d(t,{x:()=>a});class a{static{this.COSTS={generate_script:{action:"AI 스크립트 생성",cost:{"S-CRD":1,"E-CRD":0},description:"AI 기반 영상 스크립트 생성"},generate_images:{action:"AI 이미지 생성",cost:{"S-CRD":1,"E-CRD":0},description:"이미지 1개 생성당"},render_video:{action:"영상 렌더링",cost:{"S-CRD":2,"E-CRD":0},description:"영상 1개 렌더링"},download_youtube:{action:"YouTube 다운로드",cost:{"S-CRD":1,"E-CRD":0},description:"YouTube 영상 다운로드"},export_high_quality:{action:"고품질 내보내기",cost:{"S-CRD":0,"E-CRD":1},description:"고화질/고프레임 렌더링"}}}static{this.DEMO_CREDITS={"S-CRD":100,"E-CRD":50,total:150,lastUpdated:new Date}}static async getCreditBalance(e){return{...this.DEMO_CREDITS}}static async canAfford(e,t,r=1){try{let a=await this.getCreditBalance(e),s=this.COSTS[t];if(!s)throw Error(`알 수 없는 액션: ${t}`);let i=s.cost["S-CRD"]*r,o=s.cost["E-CRD"]*r;return a["S-CRD"]>=i&&a["E-CRD"]>=o}catch(e){return console.error("크레딧 확인 오류:",e),!1}}static async spendCredits(e,t,r=1,a){let s=this.COSTS[t];if(!s)throw Error(`알 수 없는 액션: ${t}`);let i=s.cost["S-CRD"]*r,o=s.cost["E-CRD"]*r;if(!await this.canAfford(e,t,r))throw Error("크레딧이 부족합니다.");let n=await this.getCreditBalance(e);return{id:`demo_${Date.now()}`,userId:e,type:"spend",amount:i+o,creditType:o>0?"E-CRD":"S-CRD",description:`${s.description} (${r}개)`,category:this.getCategoryFromAction(t),metadata:{...a,action:t,quantity:r,cost_breakdown:s.cost},balance:{"S-CRD":n["S-CRD"],"E-CRD":n["E-CRD"]},createdAt:new Date}}static async addCredits(e,t,r,a,s){let i=await this.getCreditBalance(e);return{id:`demo_${Date.now()}`,userId:e,type:"earn",amount:t,creditType:r,description:a,category:s?.category||"bonus",metadata:s,balance:i,createdAt:new Date}}static async getTransactionHistory(e,t=50){return[]}static getCategoryFromAction(e){return({generate_script:"script",generate_images:"image",render_video:"video",download_youtube:"video",export_high_quality:"video"})[e]||"other"}static getAvailableActions(){return{...this.COSTS}}static async giveDailyLoginBonus(e){return!1}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,5972],()=>r(8262));module.exports=a})();