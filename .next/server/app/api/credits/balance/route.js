"use strict";(()=>{var e={};e.id=7266,e.ids=[7266],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8733:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>D,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>C});var a={};r.r(a),r.d(a,{GET:()=>l});var s=r(9303),i=r(8716),o=r(670),n=r(7070),d=r(8311);let c=new Map;async function l(e){let t=`credit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r=Date.now(),a={userId:"unknown"};try{console.log(`ğŸ’° [${t}] í¬ë ˆë”§ ì”ì•¡ ì¡°íšŒ ìš”ì²­ ì‹œì‘`);let s=function(e){let t=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown",r=e.headers.get("user-agent")||"unknown",a=e.headers.get("x-user-id")||void 0;return!r||r.length<10?{isValid:!1,error:"ìœ íš¨í•˜ì§€ ì•Šì€ User-Agent"}:{isValid:!0,clientIp:t,userId:a}}(e);if(!s.isValid)return console.warn(`âš ï¸ [${t}] ë³´ì•ˆ ê²€ì¦ ì‹¤íŒ¨: ${s.error}`),n.NextResponse.json({success:!1,error:"ë³´ì•ˆ ê²€ì¦ ì‹¤íŒ¨",details:s.error,requestId:t},{status:403,headers:{"X-Request-ID":t,"Retry-After":"60"}});if(s.userId||s.clientIp){let e=function(e,t){let r=Date.now(),a=t?`user_${t}`:`ip_${e}`,s=c.get(a);return!s||r>s.resetTime?(c.set(a,{count:1,resetTime:r+6e4}),{allowed:!0}):s.count>=30?{allowed:!1,error:"í¬ë ˆë”§ ì¡°íšŒ ìš”ì²­ ì†ë„ ì œí•œì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤",retryAfter:Math.ceil((s.resetTime-r)/1e3)}:(s.count++,{allowed:!0})}(s.clientIp,s.userId);if(!e.allowed)return console.warn(`âš ï¸ [${t}] í¬ë ˆë”§ ì¡°íšŒ ì†ë„ ì œí•œ ì´ˆê³¼`),n.NextResponse.json({success:!1,error:"í¬ë ˆë”§ ì¡°íšŒ ì†ë„ ì œí•œ ì´ˆê³¼",details:e.error,requestId:t},{status:429,headers:{"X-Request-ID":t,"Retry-After":String(e.retryAfter||60)}})}let{searchParams:i}=new URL(e.url),o=i.get("userId"),l=function(e){if(!e)return{isValid:!1,error:"ì‚¬ìš©ì IDê°€ í•„ìš”í•©ë‹ˆë‹¤."};if("string"!=typeof e)return{isValid:!1,error:"ì‚¬ìš©ì IDëŠ” ë¬¸ìì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤."};let t=e.trim();return 0===t.length?{isValid:!1,error:"ì‚¬ìš©ì IDëŠ” ë¹„ì–´ìˆì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}:t.length>100?{isValid:!1,error:"ì‚¬ìš©ì IDê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤ (ìµœëŒ€ 100ì)."}:/^[a-zA-Z0-9_-]+$/.test(t)?{isValid:!0,sanitizedUserId:t}:{isValid:!1,error:"ì‚¬ìš©ì IDì— í—ˆìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤."}}(o);if(!l.isValid)return console.warn(`âš ï¸ [${t}] ì‚¬ìš©ì ID ê²€ì¦ ì‹¤íŒ¨: ${l.error}`),n.NextResponse.json({success:!1,error:"ìš”ì²­ íŒŒë¼ë¯¸í„° ê²€ì¦ ì‹¤íŒ¨",details:l.error,requestId:t},{status:400,headers:{"X-Request-ID":t}});let u=l.sanitizedUserId;a.userId=u,console.log(`ğŸ¯ [${t}] í¬ë ˆë”§ ì”ì•¡ ì¡°íšŒ: userId=${u}`);let p=await d.x.getCreditBalance(u),C=Date.now()-r;return console.log(`âœ… [${t}] í¬ë ˆë”§ ì”ì•¡ ì¡°íšŒ ì„±ê³µ: ${C}ms`),n.NextResponse.json({success:!0,data:"S-CRD"in p?{SCrd:p["S-CRD"]||0,ECrd:p["E-CRD"]||0,totalCredits:p.total||0,lastUpdated:p.lastUpdated}:{SCrd:p.SCrd||0,ECrd:p.ECrd||0,totalCredits:(p.SCrd||0)+(p.ECrd||0),bonusCredits:p.bonusCredits||0,earnedCredits:p.earnedCredits||0,totalSpent:p.totalSpent||0,monthlyLimit:p.monthlyLimit,dailyUsage:p.dailyUsage||0,creditHistory:p.creditHistory?.slice(0,10)||[]},metadata:{requestId:t,processingTime:C,userId:u,operation:"balance",timestamp:new Date().toISOString()}},{headers:{"X-Request-ID":t,"X-Processing-Time":String(C),"Cache-Control":"public, max-age=30"}})}catch(d){let e=Date.now()-r;console.error(`âŒ [${t}] í¬ë ˆë”§ ì”ì•¡ ì¡°íšŒ ì˜¤ë¥˜:`,{error:d.message,stack:d.stack,processingTime:e});let s=500,i="internal_error",o="í¬ë ˆë”§ ì”ì•¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";return"ValidationError"===d.name?(s=400,i="validation_error",o="ìš”ì²­ ë°ì´í„°ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."):"UserNotFoundError"===d.name?(s=404,i="user_not_found",o="ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."):"DatabaseError"===d.name?(s=503,i="database_error",o="ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤."):"AuthenticationError"===d.name&&(s=401,i="auth_error",o="ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),n.NextResponse.json({success:!1,error:o,details:"ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜",errorType:i,requestId:t,metadata:{processingTime:e,timestamp:new Date().toISOString(),userId:a.userId}},{status:s,headers:{"X-Request-ID":t,"X-Processing-Time":String(e)}})}}let u=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/credits/balance/route",pathname:"/api/credits/balance",filename:"route",bundlePath:"app/api/credits/balance/route"},resolvedPagePath:"C:\\projects\\survivingvid\\src\\app\\api\\credits\\balance\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:C,serverHooks:g}=u,D="/api/credits/balance/route";function h(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:C})}},8311:(e,t,r)=>{r.d(t,{x:()=>a});class a{static{this.COSTS={generate_script:{action:"AI ìŠ¤í¬ë¦½íŠ¸ ìƒì„±",cost:{"S-CRD":1,"E-CRD":0},description:"AI ê¸°ë°˜ ì˜ìƒ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±"},generate_images:{action:"AI ì´ë¯¸ì§€ ìƒì„±",cost:{"S-CRD":1,"E-CRD":0},description:"ì´ë¯¸ì§€ 1ê°œ ìƒì„±ë‹¹"},render_video:{action:"ì˜ìƒ ë Œë”ë§",cost:{"S-CRD":2,"E-CRD":0},description:"ì˜ìƒ 1ê°œ ë Œë”ë§"},download_youtube:{action:"YouTube ë‹¤ìš´ë¡œë“œ",cost:{"S-CRD":1,"E-CRD":0},description:"YouTube ì˜ìƒ ë‹¤ìš´ë¡œë“œ"},export_high_quality:{action:"ê³ í’ˆì§ˆ ë‚´ë³´ë‚´ê¸°",cost:{"S-CRD":0,"E-CRD":1},description:"ê³ í™”ì§ˆ/ê³ í”„ë ˆì„ ë Œë”ë§"}}}static{this.DEMO_CREDITS={"S-CRD":100,"E-CRD":50,total:150,lastUpdated:new Date}}static async getCreditBalance(e){return{...this.DEMO_CREDITS}}static async canAfford(e,t,r=1){try{let a=await this.getCreditBalance(e),s=this.COSTS[t];if(!s)throw Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì•¡ì…˜: ${t}`);let i=s.cost["S-CRD"]*r,o=s.cost["E-CRD"]*r;return a["S-CRD"]>=i&&a["E-CRD"]>=o}catch(e){return console.error("í¬ë ˆë”§ í™•ì¸ ì˜¤ë¥˜:",e),!1}}static async spendCredits(e,t,r=1,a){let s=this.COSTS[t];if(!s)throw Error(`ì•Œ ìˆ˜ ì—†ëŠ” ì•¡ì…˜: ${t}`);let i=s.cost["S-CRD"]*r,o=s.cost["E-CRD"]*r;if(!await this.canAfford(e,t,r))throw Error("í¬ë ˆë”§ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");let n=await this.getCreditBalance(e);return{id:`demo_${Date.now()}`,userId:e,type:"spend",amount:i+o,creditType:o>0?"E-CRD":"S-CRD",description:`${s.description} (${r}ê°œ)`,category:this.getCategoryFromAction(t),metadata:{...a,action:t,quantity:r,cost_breakdown:s.cost},balance:{"S-CRD":n["S-CRD"],"E-CRD":n["E-CRD"]},createdAt:new Date}}static async addCredits(e,t,r,a,s){let i=await this.getCreditBalance(e);return{id:`demo_${Date.now()}`,userId:e,type:"earn",amount:t,creditType:r,description:a,category:s?.category||"bonus",metadata:s,balance:i,createdAt:new Date}}static async getTransactionHistory(e,t=50){return[]}static getCategoryFromAction(e){return({generate_script:"script",generate_images:"image",render_video:"video",download_youtube:"video",export_high_quality:"video"})[e]||"other"}static getAvailableActions(){return{...this.COSTS}}static async giveDailyLoginBonus(e){return!1}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,5972],()=>r(8733));module.exports=a})();