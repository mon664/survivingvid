"use strict";exports.id=4837,exports.ids=[4837],exports.modules={5193:(e,t,r)=>{r.d(t,{h:()=>s});class i{constructor(){this.apiKeys=new Map,this.usageHistory=[],this.currentIndex=new Map,this.rateLimitCache=new Map,this.initializeApiKeys(),this.startCleanupInterval()}initializeApiKeys(){[{key:process.env.GEMINI_API_KEY||process.env.GOOGLE_AI_API_KEY||"",name:"Gemini Primary",provider:"google",priority:1,rateLimitPerMinute:60,quotaPerDay:1e4,enabled:!0,usageCount:0,errorCount:0},{key:process.env.GEMINI_BACKUP_KEY_1||"",name:"Gemini Backup 1",provider:"google",priority:2,rateLimitPerMinute:60,quotaPerDay:5e3,enabled:!!process.env.GEMINI_BACKUP_KEY_1,usageCount:0,errorCount:0},{key:process.env.GEMINI_BACKUP_KEY_2||"",name:"Gemini Backup 2",provider:"google",priority:3,rateLimitPerMinute:60,quotaPerDay:5e3,enabled:!!process.env.GEMINI_BACKUP_KEY_2,usageCount:0,errorCount:0},{key:process.env.HUGGINGFACE_API_KEY||"",name:"HuggingFace Primary",provider:"huggingface",priority:1,rateLimitPerMinute:30,quotaPerDay:1e3,enabled:!!process.env.HUGGINGFACE_API_KEY,usageCount:0,errorCount:0}].forEach(e=>{if(e.key&&e.enabled){let t=this.generateKeyId(e);this.apiKeys.set(t,e),this.currentIndex.set(e.provider,0),this.rateLimitCache.set(t,[]),console.log(`ğŸ”‘ API Key registered: ${e.name} (${e.provider})`)}}),console.log(`ğŸ” API Key Manager initialized: ${this.apiKeys.size} keys loaded`)}getApiKey(e){let t=Array.from(this.apiKeys.entries()).filter(([t,r])=>r.provider===e&&r.enabled&&!this.isKeyBanned(r));if(0===t.length)return console.error(`âŒ No available API keys for provider: ${e}`),null;for(let[e,r]of(t.sort(([e,t],[r,i])=>t.priority!==i.priority?t.priority-i.priority:t.usageCount-i.usageCount),t))if(!this.isRateLimited(e))return this.recordKeyUsage(e),r.key;return console.warn(`âš ï¸ All API keys rate limited for provider: ${e}`),null}recordUsage(e,t,r,i,s,a){let n={keyId:e,timestamp:Date.now(),endpoint:t,success:r,responseTime:i,tokensUsed:s,cost:a};this.usageHistory.push(n),this.updateKeyStats(e,r,i),this.usageHistory.length>1e4&&(this.usageHistory=this.usageHistory.slice(-1e4))}reportError(e,t){let r=this.apiKeys.get(e);if(r){if(r.errorCount++,r.errorCount>=5){let e=Math.min(6e4*Math.pow(2,r.errorCount-5),36e5);r.bannedUntil=Date.now()+e,console.warn(`ğŸš« API Key banned: ${r.name} (${Math.round(e/6e4)} minutes)`)}console.error(`ğŸš¨ API Key Error: ${r.name} - ${t.message}`)}}getStats(e){let t={};for(let[r,i]of this.apiKeys.entries()){if(e&&i.provider!==e)continue;let s=this.usageHistory.filter(e=>e.keyId===r);t[r]={totalRequests:s.length,successfulRequests:s.filter(e=>e.success).length,failedRequests:s.filter(e=>!e.success).length,averageResponseTime:s.length>0?s.reduce((e,t)=>e+t.responseTime,0)/s.length:0,totalCost:s.reduce((e,t)=>e+(t.cost||0),0),quotaUsage:i.usageCount/i.quotaPerDay*100,rateLimitHits:this.getRateLimitHits(r)}}return t}getSecurityReport(){let e=Date.now()-36e5,t=Array.from(this.apiKeys.values()).filter(e=>e.enabled&&!this.isKeyBanned(e)).length,r=Array.from(this.apiKeys.values()).filter(e=>this.isKeyBanned(e)).length,i=Array.from(this.apiKeys.entries()).filter(([e,t])=>t.usageCount/t.quotaPerDay>.8).map(([e,t])=>e),s=this.usageHistory.filter(t=>!t.success&&t.timestamp>e).length,a=Array.from(this.rateLimitCache.values()).reduce((e,t)=>e+t.length,0);return{totalKeys:this.apiKeys.size,activeKeys:t,bannedKeys:r,highUsageKeys:i,errorsInLastHour:s,rateLimitHits:a}}resetDaily(){for(let e of this.apiKeys.values())e.usageCount=0,e.errorCount=0,e.bannedUntil=void 0;this.usageHistory=[],this.rateLimitCache.clear(),console.log("\uD83D\uDD04 API Key Manager: Daily reset completed")}isRateLimited(e){let t=this.apiKeys.get(e);if(!t)return!0;let r=Date.now()-6e4,i=(this.rateLimitCache.get(e)||[]).filter(e=>e>r);return this.rateLimitCache.set(e,i),i.length>=t.rateLimitPerMinute}isKeyBanned(e){return!!e.bannedUntil&&Date.now()<e.bannedUntil}recordKeyUsage(e){let t=this.rateLimitCache.get(e)||[];t.push(Date.now()),this.rateLimitCache.set(e,t)}updateKeyStats(e,t,r){let i=this.apiKeys.get(e);i&&(i.usageCount++,i.lastUsed=Date.now(),!t&&i.errorCount++)}getRateLimitHits(e){return this.rateLimitCache.get(e)?.length||0}generateKeyId(e){return`${e.provider}_${e.name.replace(/\s+/g,"_").toLowerCase()}`}startCleanupInterval(){setInterval(()=>{let e=Date.now()-864e5;for(let[t,r]of(this.usageHistory=this.usageHistory.filter(t=>t.timestamp>e),this.rateLimitCache.entries())){let i=r.filter(t=>t>e);0===i.length?this.rateLimitCache.delete(t):this.rateLimitCache.set(t,i)}},36e5)}}let s=new i},1645:(e,t,r)=>{r.d(t,{sR:()=>a,tK:()=>s});class i{constructor(){this.metrics=new Map,this.alerts=[],this.performanceThresholds={responseTime:5e3,errorRate:.05,costPerOperation:.1,qualityScore:.8},this.initializeMonitoring()}initializeMonitoring(){setInterval(()=>{this.collectSystemHealth(),this.checkPerformanceThresholds()},3e4),setInterval(()=>{this.cleanupOldMetrics()},36e5)}async recordAIMetrics(e){let t={...e,operationId:this.generateOperationId(),timestamp:Date.now()},r=this.metrics.get(e.operationType)||[];r.push(t),this.metrics.set(e.operationType,r),this.checkForAlerts(t),console.log("\uD83D\uDCCA AI Metrics Recorded:",{operation:e.operationType,responseTime:t.responseTime,success:t.success,model:e.model})}getMetrics(e,t){let r=[];if(e)return this.filterMetricsByTimeRange(this.metrics.get(e)||[],t);for(let e of this.metrics.values())r.push(...e);return this.filterMetricsByTimeRange(r,t)}getPerformanceReport(e=36e5){let t=this.getMetrics(void 0,e),r=Array.from(this.metrics.keys()),i={timeRange:e,totalOperations:t.length,successRate:this.calculateSuccessRate(t),averageResponseTime:this.calculateAverageResponseTime(t),totalCost:this.calculateTotalCost(t),averageQuality:this.calculateAverageQuality(t),operationBreakdown:{},alerts:this.getRecentAlerts(e),recommendations:this.generateRecommendations(t)};for(let t of r){let r=this.filterMetricsByTimeRange(this.metrics.get(t)||[],e);i.operationBreakdown[t]={count:r.length,successRate:this.calculateSuccessRate(r),avgResponseTime:this.calculateAverageResponseTime(r),avgCost:this.calculateAverageCost(r),avgQuality:this.calculateAverageQuality(r)}}return i}checkForAlerts(e){let t=[];e.responseTime>this.performanceThresholds.responseTime&&t.push({id:this.generateAlertId(),type:"performance",severity:e.responseTime>1e4?"high":"medium",message:`Slow response time: ${e.responseTime}ms for ${e.operationType}`,timestamp:Date.now(),resolved:!1}),e.success||t.push({id:this.generateAlertId(),type:"error",severity:"high",message:`Operation failed: ${e.error||"Unknown error"}`,timestamp:Date.now(),resolved:!1}),e.cost&&e.cost>this.performanceThresholds.costPerOperation&&t.push({id:this.generateAlertId(),type:"cost",severity:"medium",message:`High cost operation: $${e.cost.toFixed(4)}`,timestamp:Date.now(),resolved:!1}),e.quality&&e.quality<this.performanceThresholds.qualityScore&&t.push({id:this.generateAlertId(),type:"performance",severity:"medium",message:`Low quality score: ${(100*e.quality).toFixed(1)}%`,timestamp:Date.now(),resolved:!1}),this.alerts.push(...t);let r=t.filter(e=>"critical"===e.severity);r.length>0&&this.sendImmediateAlerts(r)}checkPerformanceThresholds(){let e=this.getMetrics(void 0,3e5),t=1-this.calculateSuccessRate(e);t>this.performanceThresholds.errorRate&&this.alerts.push({id:this.generateAlertId(),type:"error",severity:"critical",message:`High error rate: ${(100*t).toFixed(1)}% in last 5 minutes`,timestamp:Date.now(),resolved:!1})}collectSystemHealth(){let e={cpu:100*Math.random(),memory:100*Math.random(),disk:100*Math.random(),network:100*Math.random(),activeConnections:Math.floor(1e3*Math.random()),uptime:Date.now()};return(e.cpu>90||e.memory>90||e.disk>90)&&this.alerts.push({id:this.generateAlertId(),type:"availability",severity:"critical",message:`System resources critical: CPU ${e.cpu.toFixed(1)}%, Memory ${e.memory.toFixed(1)}%`,timestamp:Date.now(),resolved:!1}),e}calculateSuccessRate(e){return 0===e.length?1:e.filter(e=>e.success).length/e.length}calculateAverageResponseTime(e){return 0===e.length?0:e.reduce((e,t)=>e+t.responseTime,0)/e.length}calculateTotalCost(e){return e.reduce((e,t)=>e+(t.cost||0),0)}calculateAverageCost(e){let t=e.filter(e=>void 0!==e.cost);return 0===t.length?0:t.reduce((e,t)=>e+(t.cost||0),0)/t.length}calculateAverageQuality(e){let t=e.filter(e=>void 0!==e.quality);return 0===t.length?0:t.reduce((e,t)=>e+(t.quality||0),0)/t.length}filterMetricsByTimeRange(e,t){if(!t)return e;let r=Date.now()-t;return e.filter(e=>e.timestamp>r)}getRecentAlerts(e){let t=Date.now()-e;return this.alerts.filter(e=>e.timestamp>t)}generateRecommendations(e){let t=[],r=this.calculateAverageResponseTime(e),i=this.calculateSuccessRate(e),s=this.calculateAverageCost(e);return r>this.performanceThresholds.responseTime&&(t.push("Consider implementing request queuing for better response times"),t.push("Optimize API calls or increase processing power")),i<.95&&(t.push("Review error handling and implement retry mechanisms"),t.push("Monitor API rate limits and implement exponential backoff")),s>this.performanceThresholds.costPerOperation&&(t.push("Consider using more cost-effective AI models"),t.push("Implement caching to reduce repeated expensive operations")),0===t.length&&t.push("System performing within optimal parameters"),t}async sendImmediateAlerts(e){console.warn("\uD83D\uDEA8 CRITICAL ALERTS:",e)}cleanupOldMetrics(){let e=Date.now()-864e5;for(let[t,r]of this.metrics.entries()){let i=r.filter(t=>t.timestamp>e);this.metrics.set(t,i)}let t=Date.now()-6048e5;this.alerts=this.alerts.filter(e=>e.timestamp>t)}generateOperationId(){return`op_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateAlertId(){return`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}let s=new i,a=s.recordAIMetrics.bind(s);s.getPerformanceReport.bind(s),s.getMetrics.bind(s)},4837:(e,t,r)=>{r.d(t,{DG:()=>u,u_:()=>c});var i,s=r(1258),a=r(1645),n=r(5193);!function(e){e.AUTHENTICATION_ERROR="AuthenticationError",e.RATE_LIMIT_ERROR="RateLimitError",e.TIMEOUT_ERROR="TimeoutError",e.VALIDATION_ERROR="ValidationError",e.CONTENT_POLICY_ERROR="ContentPolicyError",e.QUOTA_EXCEEDED_ERROR="QuotaExceededError",e.MODEL_UNAVAILABLE_ERROR="ModelUnavailableError",e.NETWORK_ERROR="NetworkError",e.INTERNAL_ERROR="InternalError"}(i||(i={}));class o{constructor(e,t){this.apiKeys=[],this.currentKeyIndex=0,this.apiEndpoint="",this.apiKey="",this.initializeApiKeys(e),this.security={apiKeyRotation:!0,rateLimitPerMinute:60,maxRetries:3,timeoutMs:3e4,...t},this.metrics={requestCount:0,successRate:0,averageLatency:0,tokenUsage:0,errorTypes:new Map},this.researchSystem={questionGeneration:!0,contextualAnalysis:!0,knowledgeGraph:!0,adaptiveLearning:!0},this.config={temperature:.82,topK:40,topP:.95,maxOutputTokens:16384,candidateCount:1,responseMimeType:"application/json"},this.initializeModel()}initializeApiKeys(e){let t=n.h.getApiKey("google");if(!t)throw Error("ì‚¬ìš© ê°€ëŠ¥í•œ Google API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤. API í‚¤ ê´€ë¦¬ìë¥¼ í™•ì¸í•˜ì„¸ìš”.");this.apiKeys=[t],console.log(`ğŸ”‘ ì—”í„°í”„ë¼ì´ì¦ˆ API í‚¤ ê´€ë¦¬ìì—ì„œ í‚¤ ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ`)}rotateApiKey(){this.apiKeys.length<=1||(this.currentKeyIndex=(this.currentKeyIndex+1)%this.apiKeys.length,console.log(`ğŸ”‘ API í‚¤ ìˆœí™˜: ${this.currentKeyIndex+1}/${this.apiKeys.length}`),this.initializeModel())}initializeModel(){let e=this.apiKeys[this.currentKeyIndex];this.genAI=new s.$D(e),this.model=this.genAI.getGenerativeModel({model:"gemini-2.0-flash-exp",generationConfig:this.config}),this.apiKey=e}async generateScript(e){let t=Date.now();this.metrics.requestCount++;try{console.log(`ğŸ¬ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì‹œì‘: ${e.subject}`);let r=await this.analyzeContext(e);console.log(`ğŸ“Š ë¬¸ë§¥ ë¶„ì„ ì™„ë£Œ: ë³µì¡ë„ ${r.complexityScore}/10`),this.researchSystem.questionGeneration&&await this.generateResearchQuestions(e,r);let i=this.createOptimizedPrompt(e,r),s=await this.executeWithRetryOptimization(i),n=await this.assessResponseQuality(s,e);this.researchSystem.adaptiveLearning&&await this.updateLearningData(e,s,n);let o=Date.now()-t;return this.updateMetrics(o,!0),await (0,a.sR)({operationType:"script_generation",responseTime:o,tokenUsage:0,cost:0,success:!0,model:"gemini-1.5-flash"}),console.log(`âœ… ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ: ${o}ms, í’ˆì§ˆ: ${n}/100`),{...s,quality:n,processingTime:o,optimizationUsed:{koreanOptimization:this.config.koreanOptimization,costOptimization:this.config.costOptimization,contextualAnalysis:r}}}catch(r){let e=Date.now()-t;throw this.updateMetrics(e,!1,r.name),await (0,a.sR)({operationType:"script_generation",responseTime:e,success:!1,error:r instanceof Error?r.message:"Unknown error",model:"gemini-1.5-flash"}),console.error(`âŒ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì‹¤íŒ¨:`,r),this.createEnhancedError(r)}}async analyzeContext(e){return console.log("\uD83D\uDCCA ë¬¸ë§¥ ë¶„ì„ ê¸°ë³¸ê°’ ì‚¬ìš©"),{mainTopics:[e.subject],keyConcepts:[],targetAudience:"general",complexityScore:5,optimalLength:"medium",contentGaps:[],improvementSuggestions:[],koreanOptimization:{formalityLevel:"formal",culturalContext:"general",localizationNeeds:[]}}}async generateResearchQuestions(e,t){this.researchSystem.questionGeneration&&console.log(`ğŸ§  ${e.subject} ì£¼ì œì— ëŒ€í•œ ì—°êµ¬ ì§ˆë¬¸ ìƒì„± ê±´ë„ˆë›°ê¸°`)}createOptimizedPrompt(e,t){return this.createKoreanOptimizedPrompt(e)+`

    ğŸ” ë¬¸ë§¥ ë¶„ì„ ê²°ê³¼ ê¸°ë°˜ ìµœì í™”:
    - ë³µì¡ë„ ìˆ˜ì¤€: ${t.complexityScore}/10
    - í•µì‹¬ ì£¼ì œ: ${t.mainTopics?.join(", ")||e.subject}
    - íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤: ${t.targetAudience||"general"}

    ğŸ‡°ğŸ‡· í•œêµ­ì–´ ìµœì í™”:
    - ê²©ì‹ ìˆ˜ì¤€: ${t.koreanOptimization?.formalityLevel||"formal"}
    - ë¬¸í™”ì  ë§¥ë½: ${t.koreanOptimization?.culturalContext||"general"}

    ğŸ“ˆ í’ˆì§ˆ í–¥ìƒ ìš”êµ¬ì‚¬í•­:
    ${t.improvementSuggestions?.map(e=>`- ${e}`).join("\n")||""}
    `}async executeWithRetryOptimization(e){let t=null;for(let r=0;r<this.security.maxRetries;r++)try{console.log(`ğŸ¯ Gemini SDK ì‹¤í–‰ ì‹œë„ ${r+1}/${this.security.maxRetries}`);let t=(await this.model.generateContent(e)).response.text();if(!t)throw Error("API ì‘ë‹µì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");let i=JSON.parse(t);return this.validateAndFormatResponse(i)}catch(e){if(t=e,this.shouldRetry(e)&&r<this.security.maxRetries-1){let t=1e3*Math.pow(2,r);console.log(`â³ ${t}ms í›„ ì¬ì‹œë„...`),await this.sleep(t),this.isKeyRelatedError(e)&&this.rotateApiKey();continue}break}throw t||Error("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}async assessResponseQuality(e,t){let r=50;e.title&&e.title.length>0&&(r+=10),e.openingSegment&&e.openingSegment.script.length>0&&(r+=10),e.snippets&&e.snippets.length>0&&(r+=10),e.snippets&&e.snippets.length>=t.requestNumber&&(r+=10);let i=e.snippets?.reduce((e,t)=>e+t.script.join("").length,0)||0;i>500&&(r+=10),i>1e3&&(r+=10);let s=e.snippets?.map(e=>e.script.join("")).join(" ")||"";return this.containsKorean(s)&&(r+=10),e.snippets?.every(e=>e.imageGenPrompt)&&(r+=10),Math.min(r,100)}async updateLearningData(e,t,r){console.log(`ğŸ“š í•™ìŠµ ë°ì´í„° ì—…ë°ì´íŠ¸: í’ˆì§ˆ ${r}/100`)}createKoreanOptimizedPrompt(e){return`
You are an API-style assistant.

# STRICT OUTPUT POLICY
1. Respond **only** with a single JSON object that exactly matches "RESPONSE_SCHEMA".
2. Do **NOT** wrap the JSON in markdown fences, add comments, change key order, or include extra properties.
3. If you cannot comply, respond with:
   { "error": "EXPLANATION_OF_PROBLEM" }

# REQUEST_SCHEMA  (for reference)
{
  "subject":            string,   // ì˜ˆ: "${e.subject}"
  "requestNumber":      integer,  // ìƒì„±í•  íŒŒíŠ¸ ê°œìˆ˜(${e.requestNumber})
  "requestLanguage":    string,   // BCP-47, ì˜ˆ: "${e.requestLanguage}"
  "includeOpeningSegment":  boolean,
  "includeClosingSegment":  boolean,
  "includeImageGenPrompt":  boolean
}

# RESPONSE_SCHEMA  (keys must appear in this order)
{
  "title": string,
  "openingSegment": {
    "videoSearchKeyword": [ string, ... ],  // ìµœì†Œ 1ê°œ
    "script":            [ string, ... ],  // ë¬¸ì¥ ë°°ì—´
    "imageGenPrompt":     string
  },
  "snippets": [
    {
      "videoSearchKeyword": [ string, ... ],
      "segmentTitle":       string,
      "rank":               integer,       // 1â€¦${e.requestNumber}
      "script":             [ string, ... ],
      "imageGenPrompt":      string
    }
  ]
}

# SPECIAL_CONSTRAINTS
- openingSegment.script[0] MUST start with a curiosity-hook that prevents viewer drop-off.
- ëª¨ë“  imageGenPrompt ê¸¸ì´ëŠ” 120ì ì´í•˜.

Begin.
`}validateAndFormatResponse(e){if(!e.snippets||!Array.isArray(e.snippets))throw Error("ìœ íš¨í•˜ì§€ ì•Šì€ ì‘ë‹µ í˜•ì‹");return e}shouldRetry(e){return["RateLimitError","TimeoutError","NetworkError","ModelUnavailableError"].includes(e.name)||e.message?.includes("rate limit")||e.message?.includes("timeout")||e.message?.includes("network")}isKeyRelatedError(e){return"AuthenticationError"===e.name||"QuotaExceededError"===e.name}containsKorean(e){return/[ê°€-í£]/.test(e)}sleep(e){return new Promise(t=>setTimeout(t,e))}updateMetrics(e,t,r){if(this.metrics.averageLatency=(this.metrics.averageLatency+e)/2,t)this.metrics.successRate=(this.metrics.successRate*(this.metrics.requestCount-1)+100)/this.metrics.requestCount;else if(this.metrics.successRate=this.metrics.successRate*(this.metrics.requestCount-1)/this.metrics.requestCount,r){let e=this.metrics.errorTypes.get(r)||0;this.metrics.errorTypes.set(r,e+1)}}createEnhancedError(e){let t=Error(e.message);return t.name=e.name||"InternalError",t.context={requestCount:this.metrics.requestCount,successRate:this.metrics.successRate,apiKeyIndex:this.currentKeyIndex,timestamp:new Date().toISOString()},t}getMetrics(){return{...this.metrics}}updateConfig(e){this.config={...this.config,...e},this.initializeModel()}updateSecuritySettings(e){this.security={...this.security,...e}}calculateGeminiCost(e,t="gemini-1.5-flash"){if(!e)return 0;let r={"gemini-1.5-flash":{input:.075,output:.15},"gemini-1.5-pro":{input:.25,output:.5}},i=r[t]||r["gemini-1.5-flash"],s=(e.promptTokens||0)/1e6,a=(e.completionTokens||0)/1e6;return s*i.input+a*i.output}getEnterpriseMetrics(){return a.tK.getPerformanceReport()}getPerformanceOptimizationSuggestions(){return a.tK.getPerformanceReport().recommendations}}let l=null,c=e=>(l||(l=new o(e)),l),u=async e=>{let t=c();return await t.generateScript(e)}}};